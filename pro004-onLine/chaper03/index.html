<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaDocs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="JavaDocs">
    
    <link rel="preload" href="/pro/assets/css/0.styles.0f33a937.css" as="style"><link rel="preload" href="/pro/assets/js/app.fc49af57.js" as="script"><link rel="preload" href="/pro/assets/js/6.72f294c0.js" as="script"><link rel="preload" href="/pro/assets/js/5.1036e105.js" as="script"><link rel="prefetch" href="/pro/assets/js/10.daaf0eac.js"><link rel="prefetch" href="/pro/assets/js/100.4bda2965.js"><link rel="prefetch" href="/pro/assets/js/101.1c7c3ef2.js"><link rel="prefetch" href="/pro/assets/js/102.d33a747c.js"><link rel="prefetch" href="/pro/assets/js/103.039cfef3.js"><link rel="prefetch" href="/pro/assets/js/104.7fd48d57.js"><link rel="prefetch" href="/pro/assets/js/105.3baddbd3.js"><link rel="prefetch" href="/pro/assets/js/106.d248c985.js"><link rel="prefetch" href="/pro/assets/js/107.746fdea3.js"><link rel="prefetch" href="/pro/assets/js/108.2cc8f8a3.js"><link rel="prefetch" href="/pro/assets/js/109.625913ff.js"><link rel="prefetch" href="/pro/assets/js/11.9df9194f.js"><link rel="prefetch" href="/pro/assets/js/110.ae838e73.js"><link rel="prefetch" href="/pro/assets/js/111.6fe99d55.js"><link rel="prefetch" href="/pro/assets/js/112.3e008a73.js"><link rel="prefetch" href="/pro/assets/js/113.9f8d146a.js"><link rel="prefetch" href="/pro/assets/js/114.b74c9906.js"><link rel="prefetch" href="/pro/assets/js/115.44fcb37c.js"><link rel="prefetch" href="/pro/assets/js/116.8d301cee.js"><link rel="prefetch" href="/pro/assets/js/117.c1b33962.js"><link rel="prefetch" href="/pro/assets/js/118.2f7d33ee.js"><link rel="prefetch" href="/pro/assets/js/119.321f6973.js"><link rel="prefetch" href="/pro/assets/js/12.8407e3e9.js"><link rel="prefetch" href="/pro/assets/js/120.7306699d.js"><link rel="prefetch" href="/pro/assets/js/121.240c478d.js"><link rel="prefetch" href="/pro/assets/js/122.98c36b9c.js"><link rel="prefetch" href="/pro/assets/js/123.ec7bdea5.js"><link rel="prefetch" href="/pro/assets/js/124.a8cd4b86.js"><link rel="prefetch" href="/pro/assets/js/125.d5cd8bb8.js"><link rel="prefetch" href="/pro/assets/js/126.3c5e74d2.js"><link rel="prefetch" href="/pro/assets/js/127.ed7986a5.js"><link rel="prefetch" href="/pro/assets/js/128.da8647d2.js"><link rel="prefetch" href="/pro/assets/js/129.779993d8.js"><link rel="prefetch" href="/pro/assets/js/13.e4fea27b.js"><link rel="prefetch" href="/pro/assets/js/130.ce81961f.js"><link rel="prefetch" href="/pro/assets/js/131.7da4afba.js"><link rel="prefetch" href="/pro/assets/js/132.e37384b5.js"><link rel="prefetch" href="/pro/assets/js/133.72cc5613.js"><link rel="prefetch" href="/pro/assets/js/134.ca0573aa.js"><link rel="prefetch" href="/pro/assets/js/135.a2e8a0e3.js"><link rel="prefetch" href="/pro/assets/js/136.9bb835c5.js"><link rel="prefetch" href="/pro/assets/js/137.2690460f.js"><link rel="prefetch" href="/pro/assets/js/138.25a74226.js"><link rel="prefetch" href="/pro/assets/js/139.f70d1d1c.js"><link rel="prefetch" href="/pro/assets/js/14.95016f0e.js"><link rel="prefetch" href="/pro/assets/js/140.67a1377e.js"><link rel="prefetch" href="/pro/assets/js/141.a19fe599.js"><link rel="prefetch" href="/pro/assets/js/142.2b6419a7.js"><link rel="prefetch" href="/pro/assets/js/143.308ae89b.js"><link rel="prefetch" href="/pro/assets/js/144.d8a59337.js"><link rel="prefetch" href="/pro/assets/js/145.5341e3f8.js"><link rel="prefetch" href="/pro/assets/js/146.0d1be921.js"><link rel="prefetch" href="/pro/assets/js/147.d5f87764.js"><link rel="prefetch" href="/pro/assets/js/148.83918129.js"><link rel="prefetch" href="/pro/assets/js/149.7c89b683.js"><link rel="prefetch" href="/pro/assets/js/15.c1c144d7.js"><link rel="prefetch" href="/pro/assets/js/150.69e13076.js"><link rel="prefetch" href="/pro/assets/js/151.0edc1839.js"><link rel="prefetch" href="/pro/assets/js/152.41c7137e.js"><link rel="prefetch" href="/pro/assets/js/153.2da21929.js"><link rel="prefetch" href="/pro/assets/js/154.4f33b549.js"><link rel="prefetch" href="/pro/assets/js/155.e172f030.js"><link rel="prefetch" href="/pro/assets/js/156.4c90b099.js"><link rel="prefetch" href="/pro/assets/js/157.672e9235.js"><link rel="prefetch" href="/pro/assets/js/158.fe053f9f.js"><link rel="prefetch" href="/pro/assets/js/159.7bd25e88.js"><link rel="prefetch" href="/pro/assets/js/16.afc4319b.js"><link rel="prefetch" href="/pro/assets/js/160.16bf8796.js"><link rel="prefetch" href="/pro/assets/js/161.a4f03362.js"><link rel="prefetch" href="/pro/assets/js/162.216cd3b0.js"><link rel="prefetch" href="/pro/assets/js/163.f253af0f.js"><link rel="prefetch" href="/pro/assets/js/164.d9cd6ca6.js"><link rel="prefetch" href="/pro/assets/js/165.3b274dbe.js"><link rel="prefetch" href="/pro/assets/js/166.41cde03e.js"><link rel="prefetch" href="/pro/assets/js/167.a3cbca3a.js"><link rel="prefetch" href="/pro/assets/js/168.b176287f.js"><link rel="prefetch" href="/pro/assets/js/169.e33fb7c6.js"><link rel="prefetch" href="/pro/assets/js/17.efb82315.js"><link rel="prefetch" href="/pro/assets/js/170.8e1e1969.js"><link rel="prefetch" href="/pro/assets/js/171.b70d6b5e.js"><link rel="prefetch" href="/pro/assets/js/172.0d754141.js"><link rel="prefetch" href="/pro/assets/js/173.05ad932a.js"><link rel="prefetch" href="/pro/assets/js/174.049d6251.js"><link rel="prefetch" href="/pro/assets/js/175.25310f2d.js"><link rel="prefetch" href="/pro/assets/js/176.e8a81d92.js"><link rel="prefetch" href="/pro/assets/js/177.d90caf35.js"><link rel="prefetch" href="/pro/assets/js/178.cf1cf1bf.js"><link rel="prefetch" href="/pro/assets/js/179.4476db3b.js"><link rel="prefetch" href="/pro/assets/js/18.0db7a134.js"><link rel="prefetch" href="/pro/assets/js/180.58fb3da5.js"><link rel="prefetch" href="/pro/assets/js/181.10bc7c3a.js"><link rel="prefetch" href="/pro/assets/js/182.2905833b.js"><link rel="prefetch" href="/pro/assets/js/183.413456a9.js"><link rel="prefetch" href="/pro/assets/js/184.0ba0e068.js"><link rel="prefetch" href="/pro/assets/js/185.c51ccef2.js"><link rel="prefetch" href="/pro/assets/js/186.7b41a69d.js"><link rel="prefetch" href="/pro/assets/js/187.b37fc6d2.js"><link rel="prefetch" href="/pro/assets/js/188.33695657.js"><link rel="prefetch" href="/pro/assets/js/189.7bfbc243.js"><link rel="prefetch" href="/pro/assets/js/19.7fa8a6b8.js"><link rel="prefetch" href="/pro/assets/js/190.b1b951e1.js"><link rel="prefetch" href="/pro/assets/js/191.3c538d30.js"><link rel="prefetch" href="/pro/assets/js/192.727c2453.js"><link rel="prefetch" href="/pro/assets/js/193.763b87ea.js"><link rel="prefetch" href="/pro/assets/js/194.726f2e3d.js"><link rel="prefetch" href="/pro/assets/js/195.84e43e6c.js"><link rel="prefetch" href="/pro/assets/js/196.dc1e836e.js"><link rel="prefetch" href="/pro/assets/js/197.e54092be.js"><link rel="prefetch" href="/pro/assets/js/198.6340a77c.js"><link rel="prefetch" href="/pro/assets/js/199.5654cc94.js"><link rel="prefetch" href="/pro/assets/js/2.1225e9b4.js"><link rel="prefetch" href="/pro/assets/js/20.97ac885e.js"><link rel="prefetch" href="/pro/assets/js/200.50d882e0.js"><link rel="prefetch" href="/pro/assets/js/201.b4d8d4c2.js"><link rel="prefetch" href="/pro/assets/js/202.494743fd.js"><link rel="prefetch" href="/pro/assets/js/203.188e4486.js"><link rel="prefetch" href="/pro/assets/js/204.f4abdce1.js"><link rel="prefetch" href="/pro/assets/js/205.fb097973.js"><link rel="prefetch" href="/pro/assets/js/206.c87a2f0c.js"><link rel="prefetch" href="/pro/assets/js/207.e3ea2bea.js"><link rel="prefetch" href="/pro/assets/js/208.62eb20b5.js"><link rel="prefetch" href="/pro/assets/js/209.4ae98ccc.js"><link rel="prefetch" href="/pro/assets/js/21.fb14ab9e.js"><link rel="prefetch" href="/pro/assets/js/210.ca0e0238.js"><link rel="prefetch" href="/pro/assets/js/211.4279f359.js"><link rel="prefetch" href="/pro/assets/js/212.7c6bbef4.js"><link rel="prefetch" href="/pro/assets/js/213.ee1e3df4.js"><link rel="prefetch" href="/pro/assets/js/214.f3083281.js"><link rel="prefetch" href="/pro/assets/js/215.b003d911.js"><link rel="prefetch" href="/pro/assets/js/216.eb102128.js"><link rel="prefetch" href="/pro/assets/js/217.22a48f53.js"><link rel="prefetch" href="/pro/assets/js/218.2150478a.js"><link rel="prefetch" href="/pro/assets/js/219.421f1027.js"><link rel="prefetch" href="/pro/assets/js/22.73e0ab15.js"><link rel="prefetch" href="/pro/assets/js/220.a09eabff.js"><link rel="prefetch" href="/pro/assets/js/221.e0955959.js"><link rel="prefetch" href="/pro/assets/js/222.be029dcb.js"><link rel="prefetch" href="/pro/assets/js/223.9c146a44.js"><link rel="prefetch" href="/pro/assets/js/224.51738383.js"><link rel="prefetch" href="/pro/assets/js/225.966bd25b.js"><link rel="prefetch" href="/pro/assets/js/226.cd924613.js"><link rel="prefetch" href="/pro/assets/js/227.bdcff1cb.js"><link rel="prefetch" href="/pro/assets/js/228.a3444a64.js"><link rel="prefetch" href="/pro/assets/js/229.58e66d6c.js"><link rel="prefetch" href="/pro/assets/js/23.cb702c46.js"><link rel="prefetch" href="/pro/assets/js/230.cf8e7d9b.js"><link rel="prefetch" href="/pro/assets/js/231.11ecc275.js"><link rel="prefetch" href="/pro/assets/js/232.dce3a4c9.js"><link rel="prefetch" href="/pro/assets/js/233.cb46678c.js"><link rel="prefetch" href="/pro/assets/js/234.a6aa038f.js"><link rel="prefetch" href="/pro/assets/js/235.107d8633.js"><link rel="prefetch" href="/pro/assets/js/236.fea479b1.js"><link rel="prefetch" href="/pro/assets/js/237.211f7378.js"><link rel="prefetch" href="/pro/assets/js/238.f46a8d29.js"><link rel="prefetch" href="/pro/assets/js/239.0a3920c1.js"><link rel="prefetch" href="/pro/assets/js/24.956c5f93.js"><link rel="prefetch" href="/pro/assets/js/240.6bfb6e7f.js"><link rel="prefetch" href="/pro/assets/js/241.d8e870e5.js"><link rel="prefetch" href="/pro/assets/js/242.ccf0b4ac.js"><link rel="prefetch" href="/pro/assets/js/243.a2464b57.js"><link rel="prefetch" href="/pro/assets/js/244.baee9e74.js"><link rel="prefetch" href="/pro/assets/js/245.7766b233.js"><link rel="prefetch" href="/pro/assets/js/246.e4b61d5a.js"><link rel="prefetch" href="/pro/assets/js/247.bde7c556.js"><link rel="prefetch" href="/pro/assets/js/248.924860d4.js"><link rel="prefetch" href="/pro/assets/js/249.c87549f6.js"><link rel="prefetch" href="/pro/assets/js/25.6b9ef154.js"><link rel="prefetch" href="/pro/assets/js/250.590fe714.js"><link rel="prefetch" href="/pro/assets/js/251.4ae8a252.js"><link rel="prefetch" href="/pro/assets/js/252.18d350dc.js"><link rel="prefetch" href="/pro/assets/js/253.2748bc82.js"><link rel="prefetch" href="/pro/assets/js/254.cdd8375b.js"><link rel="prefetch" href="/pro/assets/js/255.7c748c30.js"><link rel="prefetch" href="/pro/assets/js/256.9276433a.js"><link rel="prefetch" href="/pro/assets/js/257.c7b13852.js"><link rel="prefetch" href="/pro/assets/js/258.a2357f59.js"><link rel="prefetch" href="/pro/assets/js/259.e85f4e89.js"><link rel="prefetch" href="/pro/assets/js/26.673d919c.js"><link rel="prefetch" href="/pro/assets/js/260.26747de9.js"><link rel="prefetch" href="/pro/assets/js/261.22382276.js"><link rel="prefetch" href="/pro/assets/js/262.31756a74.js"><link rel="prefetch" href="/pro/assets/js/263.f8eabe4d.js"><link rel="prefetch" href="/pro/assets/js/264.06f6e3a4.js"><link rel="prefetch" href="/pro/assets/js/265.b0e15121.js"><link rel="prefetch" href="/pro/assets/js/266.44f4bc59.js"><link rel="prefetch" href="/pro/assets/js/267.63dd20b5.js"><link rel="prefetch" href="/pro/assets/js/268.07e2c600.js"><link rel="prefetch" href="/pro/assets/js/269.e15bf2fe.js"><link rel="prefetch" href="/pro/assets/js/27.9837fb9c.js"><link rel="prefetch" href="/pro/assets/js/270.5ee91881.js"><link rel="prefetch" href="/pro/assets/js/271.cdc9dfee.js"><link rel="prefetch" href="/pro/assets/js/272.4d047eea.js"><link rel="prefetch" href="/pro/assets/js/273.8472d7b8.js"><link rel="prefetch" href="/pro/assets/js/274.b3a58455.js"><link rel="prefetch" href="/pro/assets/js/275.3928cdc5.js"><link rel="prefetch" href="/pro/assets/js/276.1e4a9acb.js"><link rel="prefetch" href="/pro/assets/js/277.86adc6b1.js"><link rel="prefetch" href="/pro/assets/js/278.ee116c86.js"><link rel="prefetch" href="/pro/assets/js/279.13716ecf.js"><link rel="prefetch" href="/pro/assets/js/28.dc286ee7.js"><link rel="prefetch" href="/pro/assets/js/280.304bb66c.js"><link rel="prefetch" href="/pro/assets/js/281.cb87e6df.js"><link rel="prefetch" href="/pro/assets/js/282.332df06b.js"><link rel="prefetch" href="/pro/assets/js/283.e175f771.js"><link rel="prefetch" href="/pro/assets/js/284.adfe8677.js"><link rel="prefetch" href="/pro/assets/js/285.2b9ddc25.js"><link rel="prefetch" href="/pro/assets/js/286.c6858854.js"><link rel="prefetch" href="/pro/assets/js/287.0cf41b14.js"><link rel="prefetch" href="/pro/assets/js/288.ff8130bf.js"><link rel="prefetch" href="/pro/assets/js/289.bc3f7f9c.js"><link rel="prefetch" href="/pro/assets/js/29.43baf2a9.js"><link rel="prefetch" href="/pro/assets/js/290.75ddf005.js"><link rel="prefetch" href="/pro/assets/js/291.05f625f0.js"><link rel="prefetch" href="/pro/assets/js/292.83c3b770.js"><link rel="prefetch" href="/pro/assets/js/293.9f678d18.js"><link rel="prefetch" href="/pro/assets/js/294.34c57094.js"><link rel="prefetch" href="/pro/assets/js/295.b26df8f3.js"><link rel="prefetch" href="/pro/assets/js/296.6dade539.js"><link rel="prefetch" href="/pro/assets/js/297.62843d30.js"><link rel="prefetch" href="/pro/assets/js/298.285685b1.js"><link rel="prefetch" href="/pro/assets/js/299.893ae364.js"><link rel="prefetch" href="/pro/assets/js/3.0b9758a9.js"><link rel="prefetch" href="/pro/assets/js/30.f2ca47e1.js"><link rel="prefetch" href="/pro/assets/js/300.371ae16e.js"><link rel="prefetch" href="/pro/assets/js/301.da1175d1.js"><link rel="prefetch" href="/pro/assets/js/302.886f50ba.js"><link rel="prefetch" href="/pro/assets/js/303.a4041c62.js"><link rel="prefetch" href="/pro/assets/js/304.86caf01e.js"><link rel="prefetch" href="/pro/assets/js/305.2e32a309.js"><link rel="prefetch" href="/pro/assets/js/306.6a266393.js"><link rel="prefetch" href="/pro/assets/js/307.a34b1931.js"><link rel="prefetch" href="/pro/assets/js/308.5b20f57c.js"><link rel="prefetch" href="/pro/assets/js/309.4763dca9.js"><link rel="prefetch" href="/pro/assets/js/31.1988cfaa.js"><link rel="prefetch" href="/pro/assets/js/310.fed041ba.js"><link rel="prefetch" href="/pro/assets/js/311.5096fc1b.js"><link rel="prefetch" href="/pro/assets/js/312.441b486e.js"><link rel="prefetch" href="/pro/assets/js/313.2998ae57.js"><link rel="prefetch" href="/pro/assets/js/314.4ef5d7b8.js"><link rel="prefetch" href="/pro/assets/js/315.16e0fa89.js"><link rel="prefetch" href="/pro/assets/js/316.e00e1d07.js"><link rel="prefetch" href="/pro/assets/js/317.1735a97f.js"><link rel="prefetch" href="/pro/assets/js/318.00c9f87d.js"><link rel="prefetch" href="/pro/assets/js/319.7d5eff35.js"><link rel="prefetch" href="/pro/assets/js/32.0a71739b.js"><link rel="prefetch" href="/pro/assets/js/320.a8123618.js"><link rel="prefetch" href="/pro/assets/js/321.9e4c3d7a.js"><link rel="prefetch" href="/pro/assets/js/322.ab5ecb28.js"><link rel="prefetch" href="/pro/assets/js/323.f5c0b737.js"><link rel="prefetch" href="/pro/assets/js/324.a4bc7818.js"><link rel="prefetch" href="/pro/assets/js/325.e7fc190c.js"><link rel="prefetch" href="/pro/assets/js/326.80bbdd10.js"><link rel="prefetch" href="/pro/assets/js/327.45c093dd.js"><link rel="prefetch" href="/pro/assets/js/328.431b7399.js"><link rel="prefetch" href="/pro/assets/js/329.3add1306.js"><link rel="prefetch" href="/pro/assets/js/33.df0d811a.js"><link rel="prefetch" href="/pro/assets/js/330.14d15f0c.js"><link rel="prefetch" href="/pro/assets/js/331.8c4fd151.js"><link rel="prefetch" href="/pro/assets/js/332.28ee4049.js"><link rel="prefetch" href="/pro/assets/js/333.b977a795.js"><link rel="prefetch" href="/pro/assets/js/334.dd6b6fd1.js"><link rel="prefetch" href="/pro/assets/js/335.82203c90.js"><link rel="prefetch" href="/pro/assets/js/336.6c07fd3d.js"><link rel="prefetch" href="/pro/assets/js/337.f58c8629.js"><link rel="prefetch" href="/pro/assets/js/338.e58ba306.js"><link rel="prefetch" href="/pro/assets/js/339.1900197d.js"><link rel="prefetch" href="/pro/assets/js/34.2a8f8418.js"><link rel="prefetch" href="/pro/assets/js/340.cd5d4675.js"><link rel="prefetch" href="/pro/assets/js/341.6b5ed662.js"><link rel="prefetch" href="/pro/assets/js/342.6c5f57cc.js"><link rel="prefetch" href="/pro/assets/js/343.58cff14f.js"><link rel="prefetch" href="/pro/assets/js/344.b7765355.js"><link rel="prefetch" href="/pro/assets/js/345.2d65a418.js"><link rel="prefetch" href="/pro/assets/js/346.82a96961.js"><link rel="prefetch" href="/pro/assets/js/347.b8a83511.js"><link rel="prefetch" href="/pro/assets/js/348.d4393f9d.js"><link rel="prefetch" href="/pro/assets/js/349.7a00a6cc.js"><link rel="prefetch" href="/pro/assets/js/35.b3f49ff7.js"><link rel="prefetch" href="/pro/assets/js/350.d55f5468.js"><link rel="prefetch" href="/pro/assets/js/351.532c0e06.js"><link rel="prefetch" href="/pro/assets/js/352.13982ed7.js"><link rel="prefetch" href="/pro/assets/js/353.69fe3cba.js"><link rel="prefetch" href="/pro/assets/js/354.18e86855.js"><link rel="prefetch" href="/pro/assets/js/355.4ced7d6e.js"><link rel="prefetch" href="/pro/assets/js/356.7d4e999e.js"><link rel="prefetch" href="/pro/assets/js/357.053f5e40.js"><link rel="prefetch" href="/pro/assets/js/358.d8ac2755.js"><link rel="prefetch" href="/pro/assets/js/359.76b7caad.js"><link rel="prefetch" href="/pro/assets/js/36.ce64d94f.js"><link rel="prefetch" href="/pro/assets/js/360.a13d1dd7.js"><link rel="prefetch" href="/pro/assets/js/361.88e34ed9.js"><link rel="prefetch" href="/pro/assets/js/362.6c6c67c6.js"><link rel="prefetch" href="/pro/assets/js/363.95c8f9e5.js"><link rel="prefetch" href="/pro/assets/js/364.6f7d5d25.js"><link rel="prefetch" href="/pro/assets/js/365.652862b2.js"><link rel="prefetch" href="/pro/assets/js/366.1a62c305.js"><link rel="prefetch" href="/pro/assets/js/367.105d9c75.js"><link rel="prefetch" href="/pro/assets/js/368.76a437fb.js"><link rel="prefetch" href="/pro/assets/js/369.3befbc83.js"><link rel="prefetch" href="/pro/assets/js/37.4a12a54e.js"><link rel="prefetch" href="/pro/assets/js/370.50bc739d.js"><link rel="prefetch" href="/pro/assets/js/371.cb673698.js"><link rel="prefetch" href="/pro/assets/js/372.0c0a6cde.js"><link rel="prefetch" href="/pro/assets/js/373.59d4ca83.js"><link rel="prefetch" href="/pro/assets/js/374.d4917e09.js"><link rel="prefetch" href="/pro/assets/js/375.7dd72cbe.js"><link rel="prefetch" href="/pro/assets/js/376.d0b5fde8.js"><link rel="prefetch" href="/pro/assets/js/377.ab07d392.js"><link rel="prefetch" href="/pro/assets/js/378.7626ebe8.js"><link rel="prefetch" href="/pro/assets/js/379.432a4290.js"><link rel="prefetch" href="/pro/assets/js/38.d889b025.js"><link rel="prefetch" href="/pro/assets/js/380.29ba37f6.js"><link rel="prefetch" href="/pro/assets/js/381.08eab60e.js"><link rel="prefetch" href="/pro/assets/js/382.c9900324.js"><link rel="prefetch" href="/pro/assets/js/383.d3a1668f.js"><link rel="prefetch" href="/pro/assets/js/384.3c5cd507.js"><link rel="prefetch" href="/pro/assets/js/385.4255b69c.js"><link rel="prefetch" href="/pro/assets/js/386.e63bb073.js"><link rel="prefetch" href="/pro/assets/js/387.807ba34d.js"><link rel="prefetch" href="/pro/assets/js/388.baa3cd6a.js"><link rel="prefetch" href="/pro/assets/js/389.96126282.js"><link rel="prefetch" href="/pro/assets/js/39.63ce8391.js"><link rel="prefetch" href="/pro/assets/js/390.15f0243d.js"><link rel="prefetch" href="/pro/assets/js/391.35968c20.js"><link rel="prefetch" href="/pro/assets/js/392.526c7d60.js"><link rel="prefetch" href="/pro/assets/js/393.06e2277f.js"><link rel="prefetch" href="/pro/assets/js/394.78a03ded.js"><link rel="prefetch" href="/pro/assets/js/395.e83a3bc7.js"><link rel="prefetch" href="/pro/assets/js/396.dbadc8d9.js"><link rel="prefetch" href="/pro/assets/js/397.0ab255a8.js"><link rel="prefetch" href="/pro/assets/js/398.9b01a783.js"><link rel="prefetch" href="/pro/assets/js/399.b674e81e.js"><link rel="prefetch" href="/pro/assets/js/4.dad69f74.js"><link rel="prefetch" href="/pro/assets/js/40.9860fe4d.js"><link rel="prefetch" href="/pro/assets/js/400.4af485f8.js"><link rel="prefetch" href="/pro/assets/js/401.380e31db.js"><link rel="prefetch" href="/pro/assets/js/402.f6cbabfd.js"><link rel="prefetch" href="/pro/assets/js/403.f7ad4a5a.js"><link rel="prefetch" href="/pro/assets/js/404.e892afe5.js"><link rel="prefetch" href="/pro/assets/js/405.a4703117.js"><link rel="prefetch" href="/pro/assets/js/406.29b8ec7b.js"><link rel="prefetch" href="/pro/assets/js/407.27d19604.js"><link rel="prefetch" href="/pro/assets/js/408.beafd6ce.js"><link rel="prefetch" href="/pro/assets/js/409.d8cf7137.js"><link rel="prefetch" href="/pro/assets/js/41.396c7131.js"><link rel="prefetch" href="/pro/assets/js/410.6c03fa8f.js"><link rel="prefetch" href="/pro/assets/js/411.9b0d2c49.js"><link rel="prefetch" href="/pro/assets/js/412.16f83eb9.js"><link rel="prefetch" href="/pro/assets/js/413.3add5e5c.js"><link rel="prefetch" href="/pro/assets/js/414.32124ea4.js"><link rel="prefetch" href="/pro/assets/js/415.0b22c5f9.js"><link rel="prefetch" href="/pro/assets/js/416.2196999f.js"><link rel="prefetch" href="/pro/assets/js/417.274dc4e8.js"><link rel="prefetch" href="/pro/assets/js/418.59f3311f.js"><link rel="prefetch" href="/pro/assets/js/419.0babd5a2.js"><link rel="prefetch" href="/pro/assets/js/42.95d04b81.js"><link rel="prefetch" href="/pro/assets/js/420.054d2f15.js"><link rel="prefetch" href="/pro/assets/js/421.3da639ba.js"><link rel="prefetch" href="/pro/assets/js/422.6e30ec5e.js"><link rel="prefetch" href="/pro/assets/js/423.91dff77d.js"><link rel="prefetch" href="/pro/assets/js/424.0d89c573.js"><link rel="prefetch" href="/pro/assets/js/425.740ab861.js"><link rel="prefetch" href="/pro/assets/js/426.96d3a8f2.js"><link rel="prefetch" href="/pro/assets/js/427.34a98a3a.js"><link rel="prefetch" href="/pro/assets/js/428.6910ade2.js"><link rel="prefetch" href="/pro/assets/js/429.ebb880da.js"><link rel="prefetch" href="/pro/assets/js/43.0d75a841.js"><link rel="prefetch" href="/pro/assets/js/430.46929b2e.js"><link rel="prefetch" href="/pro/assets/js/44.70145ca3.js"><link rel="prefetch" href="/pro/assets/js/45.dbfba886.js"><link rel="prefetch" href="/pro/assets/js/46.0c2773ca.js"><link rel="prefetch" href="/pro/assets/js/47.9b793d88.js"><link rel="prefetch" href="/pro/assets/js/48.82a29250.js"><link rel="prefetch" href="/pro/assets/js/49.3f07662a.js"><link rel="prefetch" href="/pro/assets/js/50.f58b76f6.js"><link rel="prefetch" href="/pro/assets/js/51.7d3bc0fe.js"><link rel="prefetch" href="/pro/assets/js/52.6836145b.js"><link rel="prefetch" href="/pro/assets/js/53.50a70ad6.js"><link rel="prefetch" href="/pro/assets/js/54.8417075e.js"><link rel="prefetch" href="/pro/assets/js/55.f9d198a9.js"><link rel="prefetch" href="/pro/assets/js/56.9184ecfd.js"><link rel="prefetch" href="/pro/assets/js/57.94e11a2b.js"><link rel="prefetch" href="/pro/assets/js/58.ba181fa2.js"><link rel="prefetch" href="/pro/assets/js/59.a6897b91.js"><link rel="prefetch" href="/pro/assets/js/60.fb7f9a23.js"><link rel="prefetch" href="/pro/assets/js/61.2f27f27f.js"><link rel="prefetch" href="/pro/assets/js/62.d9a2c8d3.js"><link rel="prefetch" href="/pro/assets/js/63.fb3af7d4.js"><link rel="prefetch" href="/pro/assets/js/64.45df2d7b.js"><link rel="prefetch" href="/pro/assets/js/65.185d58e2.js"><link rel="prefetch" href="/pro/assets/js/66.17d67747.js"><link rel="prefetch" href="/pro/assets/js/67.87e0d94f.js"><link rel="prefetch" href="/pro/assets/js/68.501208d1.js"><link rel="prefetch" href="/pro/assets/js/69.4c88d7ac.js"><link rel="prefetch" href="/pro/assets/js/7.3cb6883a.js"><link rel="prefetch" href="/pro/assets/js/70.ab26fd84.js"><link rel="prefetch" href="/pro/assets/js/71.6cd7bd7c.js"><link rel="prefetch" href="/pro/assets/js/72.48275bf1.js"><link rel="prefetch" href="/pro/assets/js/73.0908ee8d.js"><link rel="prefetch" href="/pro/assets/js/74.2495b0c8.js"><link rel="prefetch" href="/pro/assets/js/75.d1cef522.js"><link rel="prefetch" href="/pro/assets/js/76.90e07d4c.js"><link rel="prefetch" href="/pro/assets/js/77.abc45d26.js"><link rel="prefetch" href="/pro/assets/js/78.59485da7.js"><link rel="prefetch" href="/pro/assets/js/79.37437ffc.js"><link rel="prefetch" href="/pro/assets/js/8.362f6bbe.js"><link rel="prefetch" href="/pro/assets/js/80.ca186225.js"><link rel="prefetch" href="/pro/assets/js/81.07b83413.js"><link rel="prefetch" href="/pro/assets/js/82.f44d353b.js"><link rel="prefetch" href="/pro/assets/js/83.50b20e3a.js"><link rel="prefetch" href="/pro/assets/js/84.a6ffd4eb.js"><link rel="prefetch" href="/pro/assets/js/85.56e306a1.js"><link rel="prefetch" href="/pro/assets/js/86.d829e6d3.js"><link rel="prefetch" href="/pro/assets/js/87.f6642f38.js"><link rel="prefetch" href="/pro/assets/js/88.7f8f5f67.js"><link rel="prefetch" href="/pro/assets/js/89.603d3701.js"><link rel="prefetch" href="/pro/assets/js/9.866facac.js"><link rel="prefetch" href="/pro/assets/js/90.088785b0.js"><link rel="prefetch" href="/pro/assets/js/91.c0b34f80.js"><link rel="prefetch" href="/pro/assets/js/92.69aaa302.js"><link rel="prefetch" href="/pro/assets/js/93.00485bbd.js"><link rel="prefetch" href="/pro/assets/js/94.8cedc56f.js"><link rel="prefetch" href="/pro/assets/js/95.371cd790.js"><link rel="prefetch" href="/pro/assets/js/96.3aec3001.js"><link rel="prefetch" href="/pro/assets/js/97.858b2ebf.js"><link rel="prefetch" href="/pro/assets/js/98.fc140c52.js"><link rel="prefetch" href="/pro/assets/js/99.d3de64c4.js">
    <link rel="stylesheet" href="/pro/assets/css/0.styles.0f33a937.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/pro/" class="home-link router-link-active"><!----> <span class="site-name">JavaDocs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#课程大纲">课程大纲</a></li><li><a href="#_1-1-数据拓展">1.1 数据拓展</a></li><li><a href="#_1-2-常见架构">1.2 常见架构</a></li><li><a href="#_1-3-主从模式">1.3 主从模式</a><ul><li><a href="#_1-3-1-主从简介">1.3.1 主从简介</a></li><li><a href="#_1-3-2-主从搭建">1.3.2 主从搭建</a></li><li><a href="#_1-3-3-测试">1.3.3 测试</a></li></ul></li><li><a href="#_1-4-主从复制原理">1.4 主从复制原理</a><ul><li><a href="#_1-4-1-异步复制">1.4.1 异步复制</a></li><li><a href="#_1-4-2-半同步复制">1.4.2 半同步复制</a></li><li><a href="#_1-4-3-异步复制实现">1.4.3 异步复制实现</a></li><li><a href="#_1-4-4-半同步复制实现">1.4.4 半同步复制实现</a></li></ul></li><li><a href="#_1-5-主主复制">1.5 主主复制</a><ul><li><a href="#_1-5-1-简介">1.5.1 简介</a></li><li><a href="#_1-5-2-主主搭建">1.5.2 主主搭建</a></li><li><a href="#_1-5-3-测试">1.5.3 测试</a></li></ul></li><li><a href="#_1-6-级联复制-了解">1.6 级联复制(了解)</a></li><li><a href="#_1-7-双主与级联复制-了解">1.7 双主与级联复制(了解)</a></li><li><a href="#_2-1-简介">2.1 简介</a></li><li><a href="#_2-2-keepalived安装与配置">2.2 keepAlived安装与配置</a></li><li><a href="#_3-1-简介">3.1 简介</a></li><li><a href="#_3-2-水平切分">3.2 水平切分</a></li><li><a href="#_3-3-垂直切分">3.3 垂直切分</a></li><li><a href="#_3-4-存在的问题">3.4 存在的问题</a></li><li><a href="#_4-1-mycat简介">4.1 Mycat简介</a></li><li><a href="#_4-2-mycat安装">4.2 Mycat安装</a></li><li><a href="#_4-3-mycat核心概念">4.3 Mycat核心概念</a></li><li><a href="#_5-1-环境准备">5.1 环境准备</a></li><li><a href="#_5-2-通过mycat访问数据库">5.2 通过Mycat访问数据库</a><ul><li><a href="#_5-2-1-server-xml配置">5.2.1 server.xml配置</a></li><li><a href="#_5-2-2-schema-xml配置">5.2.2 schema.xml配置</a></li><li><a href="#_5-2-3-访问测试">5.2.3 访问测试</a></li></ul></li><li><a href="#_5-3-数据分片">5.3 数据分片</a><ul><li><a href="#_5-3-1-取模分片">5.3.1 取模分片</a></li><li><a href="#_5-3-2-全局id分片">5.3.2 全局id分片</a></li><li><a href="#_5-3-3-枚举分片">5.3.3 枚举分片</a></li><li><a href="#_5-3-4-固定hash分片">5.3.4 固定hash分片</a></li><li><a href="#_5-3-5-固定范围分片">5.3.5 固定范围分片</a></li><li><a href="#_5-3-6-取模范围分片">5.3.6 取模范围分片</a></li><li><a href="#_5-3-7-字符串hash分片">5.3.7 字符串hash分片</a></li><li><a href="#_5-3-8-一致性hash">5.3.8 一致性hash</a></li><li><a href="#_5-3-9-时间分片">5.3.9 时间分片</a></li></ul></li><li><a href="#_5-4-跨库join">5.4 跨库join</a><ul><li><a href="#_5-4-1-全局表">5.4.1 全局表</a></li><li><a href="#_5-4-2-er表">5.4.2 ER表</a></li></ul></li><li><a href="#_6-1-读写分离">6.1 读写分离</a></li><li><a href="#_6-2-主从切换">6.2 主从切换</a></li></ul></div><p></p> <h1 id="mysql-day03"><a href="#mysql-day03" class="header-anchor">#</a> mysql-day03</h1> <h2 id="课程大纲"><a href="#课程大纲" class="header-anchor">#</a> 课程大纲</h2> <ul><li><strong>mysql高可用架构:主从模式 主主模式 级联复制 主主与级联结合</strong></li> <li><strong>mysql高可用进阶: keepAlived</strong></li> <li><strong>数据切分: 垂直切分 水平切分</strong></li> <li><strong>MyCat入门: 分库与分表</strong></li> <li>**Mycat高级应用: 读写分离 主从切换 **</li></ul> <h1 id="_1-mysql复制架构"><a href="#_1-mysql复制架构" class="header-anchor">#</a> 1 Mysql复制架构</h1> <h2 id="_1-1-数据拓展"><a href="#_1-1-数据拓展" class="header-anchor">#</a> 1.1 数据拓展</h2> <ul><li>热备份：数据库在运行的过程中，对数据进行备份操作。相对的，还有冷备份，冷备份需要停机，然后对数据进行备份操作。</li> <li>多活：所谓的多活，就是让数据库机器节点会存在多个，避免单点情况的出现。</li> <li>故障切换：当一台数据库物理机出现异常状况时，可以自动的切换到其他物理机上。</li> <li>读写分离：当存在存在多台数据库物理机，将读写操作分别交给不同的机器完成。</li> <li>负载均衡：假设当存在多台数据库物理机接收读请求时，多个请求会均匀的分配到不同的机器上，避免大量请求压在某一台机器上。</li></ul> <h2 id="_1-2-常见架构"><a href="#_1-2-常见架构" class="header-anchor">#</a> 1.2 常见架构</h2> <p><strong>没有百分百的完美架构，只有适合的架构</strong></p> <p>理解mysql的分库分表，先了解mysql的架构设计,在mysql架构中，经常会使用到的就是<strong>读写分离</strong>，此设计理念的基础上常见架构有: 一主一从或多从、主主复制、级联复制、主主与级联复制结合。</p> <p><strong>一主一从或多从</strong>: 一个mysql数据库主节点,一个或者多个从节点.主节点与从节点进行数据同步</p> <p><strong>主主复制</strong>: 两个mysql主节点,主节点与主节点之间进行数据同步</p> <p><strong>级联复制</strong>: 类似一主多从架构,但是从节点分级同步</p> <p><strong>主主与级联复制结合</strong>: 双主节点同步,同时从节点分级同步</p> <h2 id="_1-3-主从模式"><a href="#_1-3-主从模式" class="header-anchor">#</a> 1.3 主从模式</h2> <h3 id="_1-3-1-主从简介"><a href="#_1-3-1-主从简介" class="header-anchor">#</a> 1.3.1 主从简介</h3> <p>主从模式是使用的最多的mysql高可用架构。</p> <p>存在一台master作为写机，一个或多个slave作为读机,实现读写分离。之所以这么设计是因为在实际的情况下，读的请求量一般是远远大于写请求。架构图如下</p> <p><img src="/pro/assets/img/image-20200524232046530.9551e660.png" alt=""></p> <p><strong>优点:</strong></p> <p>读与写的节点分离,数据写入master节点后,再由master节点将数据复制到slave节点上</p> <p><strong>缺点:</strong></p> <ul><li>master是单点存在的，如果要对master进行停机维护，无法接收写请求</li> <li>master需要将写入数据复制到各个slave节点，复制是有一定的时间延迟的，因此有可能出现查询数据不一致</li> <li>对master进行停机维护，需将某一个slave提升为新的master节点，选举规则需要进行自定义</li> <li>当slave被提升为新的master后，可能会造成新的master节点与旧master的数据不一致</li></ul> <h3 id="_1-3-2-主从搭建"><a href="#_1-3-2-主从搭建" class="header-anchor">#</a> 1.3.2 主从搭建</h3> <p>在虚拟机中安装docker</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>yum install docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>若遇到如下问题:</p> <p><img src="/pro/assets/img/image-20210607104243205.25c6176c.png" alt="image-20210607104243205"></p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>#编辑yum的配置文件
vi /etc/yum/pluginconf.d/langpacks.conf
将第一行：enable=1改为enable=0

#杀掉进程即可
kill -9 8683
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>查看docker版本</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker -v
#开启启动docker
systemctl enable docker
#查看运行状态
systemctl status docker
#启动
systemctl start docker
#停止
systemctl stop docker
#重启
systemctl restart docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>搜索mysql镜像</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker search mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下载mysql镜像</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker pull docker.io/mysql:5.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>安装mysql容器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#服务一
docker run --name mysqlm1 -p 3306:3306 --privileged=true -ti -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -v /home/mysql/docker-data/m1/conf:/etc/mysql/conf.d -v /home/mysql/docker-data/m1/data/:/var/lib/mysql -v /home/mysql/docker-data/m1/logs/:/var/log/mysql -d mysql:5.7
#服务二
docker run --name mysqls1 -p 3306:3306 --privileged=true -ti -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -v /home/mysql/docker-data/s1/conf:/etc/mysql/conf.d -v /home/mysql/docker-data/s1/data/:/var/lib/mysql -v /home/mysql/docker-data/s1/logs/:/var/log/mysql -d mysql:5.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在两台机器上新增配置文件,路径为/home/mysql/docker-data/m1/conf/my.cnf</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html

[mysqld]
#
# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M
#
# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin
#
# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M

character_set_server=utf8
init_connect='SET NAMES utf8'

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

lower_case_table_names=1
#指定主机号，不允许出现重复
server-id=129
#开启binlog
log-bin=mysql-bin
auto_increment_increment=2
auto_increment_offset=1

#rpl_semi_sync_master_enabled=1
#rpl_semi_sync_master_timeout=10000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>/home/mysql/docker-data/s1/conf/my.cnf</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html

[mysqld]
#
# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M
#
# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin
#
# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M

character_set_server=utf8
init_connect='SET NAMES utf8'

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

lower_case_table_names=1
#指定主机号，不允许出现重复
server-id=130
#开启binlog
log-bin=mysql-bin
auto_increment_increment=2
auto_increment_offset=1

#rpl_semi_sync_master_enabled=1
#rpl_semi_sync_master_timeout=10000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>在master的docker容器中添加mysql权限，开启备份机复制，并且设置备份用户信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#在129服务中进入mysql容器
docker exec -it mysqlm1 /bin/bash
#添加权限
GRANT REPLICATION SLAVE,FILE,REPLICATION CLIENT ON *.* TO 'repluser'@'%' IDENTIFIED BY '123456';
#刷新权限
FLUSH PRIVILEGES;
#重启容器
docker restart mysql129
#查看129的binlog信息
show master status;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/pro/assets/img/image-20210607110056280.515a968d.png" alt="image-20210607110056280"></p> <p>接着在slave中进入到mysql容器，设置master信息，用于标注当前slave的master是谁</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#语法</span>
change master <span class="token keyword">to</span> master_host<span class="token operator">=</span><span class="token string">'master的ip'</span><span class="token punctuation">,</span>master_port<span class="token operator">=</span>master的端口号<span class="token punctuation">,</span>master_user<span class="token operator">=</span><span class="token string">'repluser'</span><span class="token punctuation">,</span>master_password<span class="token operator">=</span><span class="token string">'123456'</span><span class="token punctuation">,</span>master_log_file<span class="token operator">=</span><span class="token string">'master中的binlob文件'</span><span class="token punctuation">,</span>master_log_pos<span class="token operator">=</span>master中的position位置信息<span class="token punctuation">;</span>
<span class="token comment">#命令</span>
change master <span class="token keyword">to</span> master_host<span class="token operator">=</span><span class="token string">'192.168.200.132'</span><span class="token punctuation">,</span>master_port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>master_user<span class="token operator">=</span><span class="token string">'repluser'</span><span class="token punctuation">,</span>master_password<span class="token operator">=</span><span class="token string">'123456'</span><span class="token punctuation">,</span>master_log_file<span class="token operator">=</span><span class="token string">'mysql-bin.000001'</span><span class="token punctuation">,</span>master_log_pos<span class="token operator">=</span><span class="token number">4691</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/pro/assets/img/image-20210607110359218.4db80c38.png" alt="image-20210607110359218"></p> <p>完成后，还需要开启slave中的<strong>IO</strong>和<strong>SQL</strong>线程，这两个线程主要用于slave中进行数据备份，可以先查看slave中这两个线程的状态</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> slave <span class="token keyword">status</span>\G<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/pro/assets/img/image-20210607110453449.16ca46ef.png" alt="image-20210607110453449"></p> <p>我们发现在slave中，这两个线程是关闭的，需要将这两个线程进行开启</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#开启</span>
<span class="token keyword">start</span> slave<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/pro/assets/img/image-20210607110556762.935a57bf.png" alt="image-20210607110556762"></p> <p>到此，mysql主从复制就已经搭建完毕</p> <h3 id="_1-3-3-测试"><a href="#_1-3-3-测试" class="header-anchor">#</a> 1.3.3 测试</h3> <p><strong>case1: 查看主从相关信息</strong></p> <p>查看slave中的binlog是否已经开启</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">&quot;%log%&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/pro/assets/img/image-20210607110722242.6df191d5.png" alt="image-20210607110722242"></p> <p>查看master、slave中的进程信息</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#129和130分别输入</span>
<span class="token keyword">show</span> processlist<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>129节点内容</p> <p><img src="/pro/assets/img/image-20210607110804268.2ce557c4.png" alt="image-20210607110804268"></p> <p>130节点内容</p> <p><img src="/pro/assets/img/image-20210607110842326.d9499257.png" alt="image-20210607110842326"></p> <p><strong>case2: 数据库同步测试</strong></p> <p>在129节点创建一个数据库</p> <p><img src="data:image/png;base64,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" alt="image-20210607111110116"></p> <p>在130节点中查看数据库</p> <p><img src="data:image/png;base64,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" alt="image-20210607111131335"></p> <p><strong>case3: 表同步测试</strong></p> <p>在129中创建一张表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>t_user<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t_user<span class="token punctuation">`</span> <span class="token punctuation">(</span>
<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>username<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>address<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">10</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/pro/assets/img/image-20210607111440773.89dff92e.png" alt="image-20210607111440773"></p> <p>在130中查看表</p> <p><img src="data:image/png;base64,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" alt="image-20210607111459565"></p> <p><strong>case4: 数据同步</strong></p> <p>在129中新增一条数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>t_user<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'zhangsan'</span><span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">,</span> <span class="token string">'北京'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="data:image/png;base64,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" alt="image-20210607111612466"></p> <p>在130中查看数据</p> <p><img src="data:image/png;base64,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" alt="image-20210607111628561"></p> <p>==<strong>case5: 反向数据同步</strong>(注意一定不要搞混!!!!!!)==</p> <p>在130中新增一条数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>t_user<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'lisi'</span><span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">,</span> <span class="token string">'上海'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/pro/assets/img/image-20210607111741609.1bc3da13.png" alt="image-20210607111741609"></p> <p>在129中查看数据</p> <p><img src="data:image/png;base64,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" alt="image-20210607111805185"></p> <p><strong>==结论: 从服务中新增数据无法同步到主服务中去, 主从同步是单向的!==</strong></p> <h2 id="_1-4-主从复制原理"><a href="#_1-4-主从复制原理" class="header-anchor">#</a> 1.4 主从复制原理</h2> <h3 id="_1-4-1-异步复制"><a href="#_1-4-1-异步复制" class="header-anchor">#</a> 1.4.1 异步复制</h3> <p><img src="/pro/assets/img/image-20200824144352020.9a9604fa.png" alt=""></p> <ol><li>事务提交到master</li> <li>master接收到应用事务提交请求后，更新内部的binlog日志，让mysql引擎执行事务操作，并返回给客户端执行结果信息。同时在master中会存在一个事件监听，其会一直监听着master中binlog日志文件的改变，一旦发现日志文件发生改变，触发dump线程</li> <li>dump线程被触发后，通知slave中的IO线程现在有事务操作要进行同步</li> <li>slave中IO线程接收到通知后，会从slave中<strong>relay-log.info</strong>文件中获取slave中的binlog日志文件和pos位置信息。接着会把这部分信息发送给master的dump线程</li> <li>master的dump线程收到这些信息后，会根据slave发送的binlog日志文件和pos位置，将最新的binlog日志和pos位置后面的内容同步给slave的IO线程</li> <li>slave的IO线程接收到这些信息后，会将这部分内容同步到slave中的relay-bin文件中</li> <li>当relay-bin文件发生改变后，触发slave线程执行sql操作【异步】</li> <li>当slave向relay-bin写入完成后，会向master返回一个ACK消息，同步成功。</li></ol> <p>对于这一系列的操作，可以发现master和slave在进行同步时是以异步的方式完成的，master写入完binlog后，会马上通过引擎进行事务提交并向客户端返回响应，对于与slave同步的操作，则是异步完成的。</p> <p><strong>优点:</strong></p> <p>效率高</p> <p><strong>缺点:</strong></p> <p>可能出现数据不一致</p> <h3 id="_1-4-2-半同步复制"><a href="#_1-4-2-半同步复制" class="header-anchor">#</a> 1.4.2 半同步复制</h3> <p><img src="/pro/assets/img/image-20200824144623639.b3810560.png" alt=""></p> <p>半同步复制与异步复制的工作流程大体相似</p> <p><strong>不同点:</strong> 当master中的binlog日志写入完成后，其不会马上通过引擎进行事务提交，而会处于等待，等到slave同步完成向master返回ACK通知后，才会唤醒等待，继续向下执行。</p> <ul><li><p>等待的时长，默认为10秒，但该时间可以配置</p></li> <li><p>尽量的避免了主从数据不一致，但造成吞吐量的降低</p></li> <li><p>mysql兜底方案: 使用半同步复制进行备份时slave节点挂掉了，那么当master等待10秒后，仍然会进行引擎提交，同时会将半同步复制切换为异步复制。等到slave节点重启后，又会自动的从异步复制切换到半同步复制。</p></li></ul> <h3 id="_1-4-3-异步复制实现"><a href="#_1-4-3-异步复制实现" class="header-anchor">#</a> 1.4.3 异步复制实现</h3> <p>Mysql在进行复制操作时，默认是基于异步复制完成的。那为了更好的体会异步复制的效果，可以通过mysql日志来查看具体的复制过程效果。</p> <ol><li><strong>查看master的Mysql日志信息</strong></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker logs -f mysqlm1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/pro/assets/img/image-20210607113019936.33946c0d.png" alt="image-20210607113019936"></p> <p>​	根据当前查看的日志信息，在master中已经开启了dump线程连接到了id为130的slave节点，并且该id就是在slave的mysql配置文件中设置的id。同时pos内容包括当前的binlog日志和pos位置。</p> <ol start="2"><li><strong>查看slave的Mysql日志信息</strong></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker logs -f mysqls1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/pro/assets/img/image-20210607113156502.0b7ed1e9.png" alt="image-20210607113156502"></p> <p>根据slave中的日志信息，可以看到，当前slave中已经开启了relay-log日志，其对应文件信息就是xxxxx-relay-bin。其内部保存的就是slave中的相关binlog信息和pos位置信息。</p> <p>同时在slave中也已经开启了SQL Thread，并且根据信息可以，它会从7375d7dd3ef6-relay-bin.000001文件的4位置开始复制。</p> <p>同时在slave中也开启了IO Thread，其已经连接到master，并且会从master的binlog日志的154的位置开启复制。</p> <ol start="3"><li><strong>查看master当前的binlog日志信息</strong></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd home/mysql/docker-data/129/data/
#确定当前master正在使用的binlog日志文件
cat mysql-bin.index
#查看当前binlog日志文件内容
tail -f mysql-bin.000001
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/pro/assets/img/image-20210607113730796.ca571bae.png" alt="image-20210607113730796"></p> <ol start="4"><li><strong>查看slave当前的日志信息</strong></li></ol> <p><img src="/pro/assets/img/image-20210607114023235.81442c8d.png" alt="image-20210607114023235"></p> <h3 id="_1-4-4-半同步复制实现"><a href="#_1-4-4-半同步复制实现" class="header-anchor">#</a> 1.4.4 半同步复制实现</h3> <ol><li>进入mysql容器，加载lib，<strong>主从节点都要配置</strong>，因为主从节点间会存在切换。</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>install plugin rpl_semi_sync_master <span class="token keyword">soname</span> <span class="token string">'semisync_master.so'</span><span class="token punctuation">;</span>
install plugin rpl_semi_sync_slave <span class="token keyword">soname</span> <span class="token string">'semisync_slave.so'</span><span class="token punctuation">;</span>
<span class="token comment">#查看插件信息</span>
<span class="token keyword">show</span> plugins<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="data:image/png;base64,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" alt="image-20210607114621298"></p> <ol start="2"><li>启用半同步**（务必先启用从库，再启用主库）**</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#先启用从库，再启用主库</span>

从库：<span class="token keyword">set</span> <span class="token keyword">global</span> rpl_semi_sync_slave_enabled<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment"># 1：启用，0：禁止</span>

主库：
     <span class="token keyword">set</span> <span class="token keyword">global</span> rpl_semi_sync_master_enabled<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment"># 1：启用，0：禁止</span>
     <span class="token keyword">set</span> <span class="token keyword">global</span> rpl_semi_sync_master_timeout<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">;</span>   <span class="token comment"># 单位为ms</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="3"><li>从库重启IO Thread</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>stop slave io_thread<span class="token punctuation">;</span>
<span class="token keyword">start</span> slave io_thread<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="4"><li>查看启动状态</li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#查询状态信息</span>
<span class="token keyword">show</span> <span class="token keyword">global</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">&quot;%sync%&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/pro/assets/img/image-20210607115008800.78dd3975.png" alt="image-20210607115008800"></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#查询参数信息</span>
<span class="token keyword">show</span> <span class="token keyword">global</span> variables <span class="token operator">like</span> <span class="token string">'%sync%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/pro/assets/img/image-20210607115025368.1e806ebc.png" alt="image-20210607115025368"></p> <ol start="5"><li>半同步复制效果测试</li></ol> <ul><li>正常的向master中添加数据，slave可以进行正常数据更新</li></ul> <p><img src="data:image/png;base64,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" alt="image-20210607115320148"></p> <ul><li>关闭slave的IO,再次向master中添加数据</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>stop slave io_thread<span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>t_user<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'ding'</span><span class="token punctuation">,</span> <span class="token string">'111'</span><span class="token punctuation">,</span> <span class="token string">'武汉'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/pro/assets/img/image-20210607115718465.957280a3.png" alt="image-20210607115718465"></p> <p>==<strong>此时复制机制会由半同步复制转换为异步复制，当再次向master中添加数据，不会再次出现等待</strong>==</p> <ul><li>slave中重新开启IO Thread</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">start</span> slave io_thread<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>异步复制会再次转换为半同步复制，master中打印日志信息如下：</p> <p><img src="/pro/assets/img/image-20210607115905128.2360516f.png" alt="image-20210607115905128"></p> <p>在slave IO Tthread关闭这段时间内的数据，会同步到slave中，不会出现数据丢失</p> <p><img src="data:image/png;base64,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" alt="image-20210607115930371"></p> <h2 id="_1-5-主主复制"><a href="#_1-5-主主复制" class="header-anchor">#</a> 1.5 主主复制</h2> <h3 id="_1-5-1-简介"><a href="#_1-5-1-简介" class="header-anchor">#</a> 1.5.1 简介</h3> <p>对于主从复制来说，其内部会存在一台master以及一台或多台slave。但有一个非常明显的问题，<strong>master是单点存在</strong>。一旦master宕机，则无法进行数据的写入。为了解决这个问题，可以使用主主复制架构。</p> <p>在主主复制架构中，会存在两台master，没有slave。并且会对这两台master进行读写分离，两台master会进行相互的复制, 架构图如下:</p> <p><img src="/pro/assets/img/image-20200530012403644.db8d324f.png" alt=""></p> <p>在此架构中，两台master会进行双向复制，为什么这么做呢？ 因为假设现在负责写的master宕机了，那么写的工作则会交给之前负责读的服务器来完成，相当于它即负责写又负责读。等到原先负责写的master恢复了，其在继续负责写工作。 反之亦然。因此才需要两者间进行双向复制。</p> <p><strong>缺点: 读请求的并发量过大，服务可能产生宕机, 主主复制架构直接使用的情况较少。</strong></p> <h3 id="_1-5-2-主主搭建"><a href="#_1-5-2-主主搭建" class="header-anchor">#</a> 1.5.2 主主搭建</h3> <p>在129和130服务器,再各自创建一个实例</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker run --name mysqlm2 -p 3307:3306 --privileged=true -ti -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_USER=user -e MYSQL_PASSWORD=pass -v /home/mysql/docker-data/m2/conf:/etc/mysql/conf.d -v /home/mysql/docker-data/m2/data/:/var/lib/mysql -v /home/mysql/docker-data/m2/logs/:/var/log/mysql -d mysql:5.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>/home/mysql/docker-data/m2/conf/my.cnf</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html

[mysqld]
#
# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M
#
# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin
#
# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M

character_set_server=utf8
init_connect='SET NAMES utf8'

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

lower_case_table_names=1
#指定主机号，不允许出现重复
server-id=1321
#开启binlog
log-bin=mysql-bin
auto_increment_increment=2
auto_increment_offset=1

#rpl_semi_sync_master_enabled=1
#rpl_semi_sync_master_timeout=10000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>添加slave的相关配置, 虽然是主主模式,也要添加从用户</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#添加权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">REPLICATION</span> SLAVE<span class="token punctuation">,</span><span class="token keyword">FILE</span><span class="token punctuation">,</span><span class="token keyword">REPLICATION</span> CLIENT <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'repluser'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
<span class="token comment">#刷新权限</span>
FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>主主搭建</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#在129/130服务器上运行</span>
<span class="token keyword">show</span> master <span class="token keyword">status</span><span class="token punctuation">;</span>
<span class="token comment">#执行主主关联</span>
change master <span class="token keyword">to</span> master_host<span class="token operator">=</span><span class="token string">'172.17.0.3'</span><span class="token punctuation">,</span>master_port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>master_user<span class="token operator">=</span><span class="token string">'repluser'</span><span class="token punctuation">,</span>master_password<span class="token operator">=</span><span class="token string">'123456'</span><span class="token punctuation">,</span>master_log_file<span class="token operator">=</span><span class="token string">'mysql-bin.000003'</span><span class="token punctuation">,</span>master_log_pos<span class="token operator">=</span><span class="token number">154</span><span class="token punctuation">;</span>
<span class="token comment">#主主同步生效</span>
<span class="token keyword">start</span> slave<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>查看master 129的进程列表：show processlist;</p> <p><img src="/pro/assets/img/image-20210607143921793.9ddacbc7.png" alt="image-20210607143921793"></p> <p>slave131的进程列表：show processlist;</p> <p><img src="/pro/assets/img/image-20210607143932355.639c1a15.png" alt="image-20210607143932355"></p> <h3 id="_1-5-3-测试"><a href="#_1-5-3-测试" class="header-anchor">#</a> 1.5.3 测试</h3> <p><strong>(作业,自行测试主主模式)</strong></p> <h2 id="_1-6-级联复制-了解"><a href="#_1-6-级联复制-了解" class="header-anchor">#</a> 1.6 级联复制(了解)</h2> <p>写请求的入口为一个，但当master向slave进行复制时，对于slave可以分为多层， master只要向其中两台slave复制即可，然后再由slave将其数据复制到后面更多的slave中。通过这种方式可以减轻master向slave复制的IO压力。但是这种架构会使slave的延迟会加大,架构如下图:</p> <p><img src="/pro/assets/img/image-20200601225751946.87180dab.png" alt=""></p> <h2 id="_1-7-双主与级联复制-了解"><a href="#_1-7-双主与级联复制-了解" class="header-anchor">#</a> 1.7 双主与级联复制(了解)</h2> <p>对于master在前面几种架构设计中，都存在单点问题， 对于master单点问题的解决，可以采用当前的架构。</p> <p>通过这种架构不仅可以解决master单点的问题，也可以解决slave延迟的问题, 架构图如下:</p> <p><img src="/pro/assets/img/image-20200601230908495.683bc51d.png" alt=""></p> <h1 id="_2-mysql高可用"><a href="#_2-mysql高可用" class="header-anchor">#</a> 2 Mysql高可用</h1> <h2 id="_2-1-简介"><a href="#_2-1-简介" class="header-anchor">#</a> 2.1 简介</h2> <p>以主主架构为例，现在不管写或者读，只要其中一个宕机，则会把它本身工作交给另外一台服务器完成。此时就需要对IP进行一个自动的指向。而且这种服务器IP切换，对于上层应用来说，应该是完全隐藏的，其无需知道当前是由谁来完成具体工作，其只需要来连接一个IP就可以。</p> <p>对于这种需求，就需要通过<strong>keepAlived</strong>来完成IP的自动切换。</p> <p>Keepalived是Linux下一个轻量级别的高可用解决方案。高可用(High Avalilability,HA)，其实两种不同的含义：广义来讲，是指整个系统的高可用行，狭义的来讲就是之主机的冗余和接管，</p> <p>它与HeartBeat RoseHA 实现相同类似的功能，都可以实现服务或者网络的高可用，但是又有差别，HeartBeat是一个专业的、功能完善的高可用软件，它提供了HA 软件所需的基本功能，比如：心跳检测、资源接管，检测集群中的服务，在集群节点转移共享IP地址的所有者等等。HeartBeat功能强大，但是部署和使用相对比较麻烦，</p> <p>与HeartBeat相比，Keepalived主要是通过虚拟路由冗余来实现高可用功能，虽然它没有HeartBeat功能强大，但是Keepalived部署和使用非常的简单，所有配置只需要一个配置文件即可以完成</p> <p><img src="/pro/assets/img/image-20200530020827979.5a902471.png" alt=""></p> <p>对于keepalived会在多台mysql服务器进行安装， 同时keepalived间也分为master和slave，  同时master会虚拟化一个VIP供应用进行连接。  如果一旦master挂掉后，会由slave节点继续工作，同时slave节点也会虚拟出相同VIP，供应用进行连接</p> <h2 id="_2-2-keepalived安装与配置"><a href="#_2-2-keepalived安装与配置" class="header-anchor">#</a> 2.2 keepAlived安装与配置</h2> <ol><li><strong>安装keepalived</strong></li></ol> <p>下载keepalied安装包 http://www.keepalived.org/download.html</p> <p><img src="/pro/assets/img/image-20210607144828730.4374b96e.png" alt="image-20210607144828730"></p> <p>安装相关的环境依赖</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>yum install killall
yum -y install openssl-devel gcc gcc-c++
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>yum install killall若出现以下错误,命令更换为yum install psmisc</p> <p><img src="/pro/assets/img/image-20210607145055820.675657bf.png" alt="image-20210607145055820"></p> <p>创建keepalived安装文件目录</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir /etc/keepalived
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上传文件并解压</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>tar -zxvf keepalived-2.2.2.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>将解压的程序复制到用户目录</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mv keepalived-2.2.2 /usr/local/keepalived
cd /usr/local/keepalived
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>安装</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>./configure &amp;&amp; make &amp;&amp; make install
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建启动文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cp  -a /usr/local/etc/keepalived   /etc/init.d/
cp  -a /usr/local/etc/sysconfig/keepalived    /etc/sysconfig/
cp  -a /usr/local/sbin/keepalived    /usr/sbin/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>编写shell脚本,<strong>进入/etc/keepalived。创建chk.sh</strong>，同时赋予执行权限：chmod +x chk.sh</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#! /bin/bash</span>
mysql -h <span class="token number">192.168</span>.200.129 -u root -p123456 -P <span class="token number">3306</span> -e <span class="token string">&quot;show status;&quot;</span> <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot; <span class="token variable">$host</span> mysql login successfully &quot;</span>
    <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">else</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;  mysql login faild&quot;</span>
    <span class="token function">killall</span> keepalived
    <span class="token builtin class-name">exit</span> <span class="token number">2</span>
<span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>编写keepalived配置文件keepalived.conf</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>! Configuration File for keepalived

global_defs {
   notification_email {
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   }
   notification_email_from Alexandre.Cassen@firewall.loc
   smtp_server 192.168.200.1
   smtp_connect_timeout 30
   router_id LVS_DEVEL
   vrrp_skip_check_adv_addr
   vrrp_strict
   vrrp_garp_interval 0
   vrrp_gna_interval 0
}

vrrp_script chk_haproxy {
    script &quot;/etc/keepalived/chk.sh&quot;
    interval 2  #脚本循环运行间隔
}

vrrp_instance VI_1 {
    state BACKUP
    interface ens33
    virtual_router_id 51
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        192.168.200.200
    }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>启动</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>systemctl start keepalived
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ps -ef|grep keepalived
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/pro/assets/img/image-20210607154056173.173559fa.png" alt="image-20210607154056173"></p> <p>查看ip信息，此时可以发现出现了配置的虚拟ip</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ip a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/pro/assets/img/image-20210607154142666.cf197b5c.png" alt="image-20210607154142666"></p> <p><img src="/pro/assets/img/image-20210607154237635.7a04ca79.png" alt="image-20210607154237635"></p> <h1 id="_3-数据分片"><a href="#_3-数据分片" class="header-anchor">#</a> 3 数据分片</h1> <h2 id="_3-1-简介"><a href="#_3-1-简介" class="header-anchor">#</a> 3.1 简介</h2> <p>当前微服务架构非常流行，很多都会采用微服务架构对其系统进行拆分。 而虽然产生了多个微服务，但因为其用户量和数据量的问题，很有可能仍然使用的是同一个数据库。但是随着用户量和数据量增加，就会出现很多影响数据库性能的因素，如：数据存储量、IO瓶颈、访问量瓶颈等。此时就需要将数据进行拆分，从一个库拆分成多个库。</p> <p><img src="/pro/assets/img/image-20200601232224434.0c0be98c.png" alt=""></p> <h2 id="_3-2-水平切分"><a href="#_3-2-水平切分" class="header-anchor">#</a> 3.2 水平切分</h2> <p>为了解决垂直拆分出现的问题，可以使用水平拆分继续横向扩展，首先，可以如果<strong>当前数据库的容量没有问题</strong>的话，可以对读写极其频繁且数据量超大的表进行<strong>分表</strong>操作。由一张表拆分出多张表。</p> <p>在一个库中，拆分出多张表，每张表存储不同的数据，这样对于其操作效率会有明显的提升。而且因为处于同一个库中，也不会出现分布式事务的问题。</p> <p><img src="/pro/assets/img/image-20200602001628392.2d2aab1d.png" alt=""></p> <p>而拆分出多张表后，如果当前数据库的容量已经不够了，但是还要继续拆分的话，就可以进行<strong>分库</strong>操作，产生多个数据库，然后在扩展出的数据库中继续扩展表。</p> <p><img src="/pro/assets/img/image-20200602002017703.a5ca36b8.png" alt=""></p> <p><strong>优点：</strong></p> <ul><li>尽量的避免了跨库join操作</li> <li>不会存在超大型表的性能瓶颈问题</li> <li>事务处理相对简单</li> <li>只要拆分规则定义好，很难出现扩展性的限制</li></ul> <p><strong>缺点：</strong></p> <ul><li>拆分规则不好明确，规则一定会和业务挂钩，如根据id、根据时间等</li> <li>不好明确数据位置，难以进行维护</li> <li>多数据源管理难度加大，代码复杂度增加</li> <li>也会存在分布式事务问题</li> <li>数据库维护成本增加</li></ul> <h2 id="_3-3-垂直切分"><a href="#_3-3-垂直切分" class="header-anchor">#</a> 3.3 垂直切分</h2> <p>垂直拆分是按照业务将表进行分类并分布到不同的数据节点上。在初始进行数据拆分时，使用垂直拆分是非常直观的一种方式。</p> <p><img src="/pro/assets/img/image-20200601235540364.d74bb0de.png" alt=""></p> <p><strong>优点：</strong></p> <ul><li>拆分规格明确，按照不同的功能模块或服务分配不同的数据库</li> <li>数据维护与定位简单</li></ul> <p><strong>缺点：</strong></p> <ul><li>对于读写极其频繁且数据量超大的表，仍然存在存储与性能瓶颈。简单的索引此时已经无法解决问题</li> <li>会出现跨库join</li> <li>需要对代码进行重构，修改原有的事务操作</li> <li>某个表数据量达到一定程度后扩展起来较为困难</li></ul> <h2 id="_3-4-存在的问题"><a href="#_3-4-存在的问题" class="header-anchor">#</a> 3.4 存在的问题</h2> <p><strong>数据切分带来的问题:</strong></p> <ul><li>产生引入分布式事务的问题</li> <li>跨节点 Join 的问题</li> <li>跨节点合并排序分页问题</li></ul> <p>例如:</p> <ul><li>按照用户ID求模，将数据分散到不同的数据库，具有相同数据用户的数据都被分散到一个库中</li> <li>按照日期，将不同月甚至日的数据分散到不同的库中</li> <li>按照某个特定的字段求模，或者根据特定范围段分散到不同的库中</li></ul> <h1 id="_4-mycat工具"><a href="#_4-mycat工具" class="header-anchor">#</a> 4 Mycat工具</h1> <h2 id="_4-1-mycat简介"><a href="#_4-1-mycat简介" class="header-anchor">#</a> 4.1 Mycat简介</h2> <p>当对数据拆分后会产生诸多的问题，对于这些问题的解决，可以借助于数据库中间件来进行解决，现在时下比较流行的是使用Mycat。</p> <p>Mycat是一款数据库中间件，对于应用程序来说是完全透明化的，不管底层的数据如何拆分，应用只需要连接Mycat即可完成对数据的操作。同时它还支持MySQL、SQL Server、Oracle、DB2、PostgreSQL等主流数据库。但是Mycat不会进行数据存储，它只是用于数据的路由。</p> <p>其底层是基于拦截思想实现，其会拦截用户发送过来的SQL语句，首先对SQL语句做了一些特定的分析：如分片分析、路由分析、读写分离分析、缓存分析等，然后将此SQL发往后端的真实数据库，并将返回的结果做适当的处理，最终再返回给用户。</p> <p><img src="/pro/assets/img/image-20200602235241816.1fb196e1.png" alt=""></p> <p>Mycat的特性如下:</p> <ul><li>支持SQL92标准</li> <li>遵守Mysql原生协议，跨语言，跨平台，跨数据库的通用中间件代理</li> <li>基于心跳的自动故障切换，支持读写分离，支持MySQL主从，以及galera cluster集群</li> <li>支持Galera for MySQL集群，Percona Cluster或者MariaDB cluster</li> <li>基于Nio实现，有效管理线程，高并发问题</li> <li>支持数据的多片自动路由与聚合，支持sum,count,max等常用的聚合函数</li> <li>支持单库内部任意join，支持跨库2表join</li> <li>支持通过全局表，ER关系的分片策略，实现了高效的多表join查询</li> <li>支持多租户方案</li> <li>支持分布式事务</li> <li>支持全局序列号，解决分布式下的主键生成问题</li> <li>分片规则丰富，插件化开发，易于扩展</li> <li>强大的web，命令行监控</li> <li>支持前端作为mysq通用代理，后端JDBC方式支持Oracle、DB2、SQL Server 、 mongodb</li> <li>支持密码加密</li> <li>支持服务降级</li> <li>支持IP白名单</li> <li>支持SQL黑名单、sql注入攻击拦截</li> <li>支持分表(1.6以后版本)</li> <li>集群基于ZooKeeper管理，在线升级，扩容，智能优化，大数据处理（2.0以后版本）</li></ul> <h2 id="_4-2-mycat安装"><a href="#_4-2-mycat安装" class="header-anchor">#</a> 4.2 Mycat安装</h2> <p>**源码下载：**https://codeload.github.com/MyCATApache/Mycat-Server/zip/Mycat-server-1675-release</p> <p><strong>官网:</strong> http://www.mycat.org.cn/</p> <p><strong>默认端口：8066</strong></p> <p><strong>配置启动参数：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#环境变量
-DMYCAT_HOME=D:\workspace\Mycat-Server-Mycat-server-1675-release\src\main
#设置堆外内存大小:当使用mycat对非分片查询时，会把所有的数据查询出来，然后把这部分数据放在堆外内存中
-XX:MaxDirectMemorySize=512M 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在Mycat有核心三个配置文件，分别为：<strong>sever.xml、schema.xml、rule.xml</strong></p> <ul><li><strong>sever.xml</strong>：是Mycat服务器参数调整和用户授权的配置文件</li> <li><strong>schema.xml</strong>：是逻辑库定义和表以及分片定义的配置文件</li> <li><strong>rule.xml</strong>：是分片规则的配置文件，分片规则的具体一些参数信息单独存放为文件，也在这个目录下，配置文件修改需要重启</li></ul> <h2 id="_4-3-mycat核心概念"><a href="#_4-3-mycat核心概念" class="header-anchor">#</a> 4.3 Mycat核心概念</h2> <ul><li><strong>逻辑库</strong>：Mycat中的虚拟数据库。对应实际数据库的概念。在没有使用mycat时，应用需要确定当前连接的数据库等信息，那么当使用mycat后，也需要先虚拟一个数据库，用于应用的连接。</li> <li><strong>逻辑表</strong>：mycat中的虚拟数据表。对应时间数据库中数据表的概念。</li> <li><strong>非分片表</strong>：没有进行数据切分的表。</li> <li><strong>分片表</strong>：已经被数据拆分的表，每个分片表中都有原有数据表的一部分数据。多张分片表可以构成一个完整数据表。</li> <li><strong>ER表</strong>：子表的记录与所关联的父表记录存放在同一个数据分片上，即子表依赖于父表，通过表分组（Table Group）保证数据Join不会跨库操作。表分组（Table Group）是解决跨分片数据join的一种很好的思路，也是数据切分规划的重要一条规则</li> <li><strong>全局表</strong>：可以理解为是一张数据冗余表，如状态表，每一个数据分片节点又保存了一份状态表数据。数据冗余是解决跨分片数据join的一种很好的思路，也是数据切分规划的另外一条重要规则。</li> <li><strong>分片节点（dataNode）</strong>：数据切分后，每一个数据分片表所在的数据库就是分片节点。</li> <li><strong>节点主机（dataHost）</strong>：数据切分后，每个分片节点（dataNode）不一定都会独占一台机器，同一机器上面可以有多个分片数据库，这样一个或多个分片节点（dataNode）所在的机器就是节点主机（dataHost）,为了规避单节点主机并发数限制，尽量将读写压力高的分片节点（dataNode）均衡的放在不同的节点主机（dataHost）。</li> <li><strong>分片规则（rule）</strong>：按照某种业务规则把数据分到某个分片的规则就是分片规则。</li> <li><strong>全局序列号（sequence）</strong>：也可以理解为分布式id。数据切分后，原有的关系数据库中的主键约束在分布式条件下将无法使用，因此需要引入外部机制保证数据唯一性标识，这种保证全局性的数据唯一标识的机制就是全局序列号（sequence），如UUID、雪花算法等。</li></ul> <h1 id="_5-mycat入门"><a href="#_5-mycat入门" class="header-anchor">#</a> 5 Mycat入门</h1> <h2 id="_5-1-环境准备"><a href="#_5-1-环境准备" class="header-anchor">#</a> 5.1 环境准备</h2> <p>在server.xml 文件中的system标签下配置所有的参数，全部为环境参数，可以根据当前需要进行开启和配置，如：设置mycat连接端口号</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>serverPort<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>8066<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/pro/assets/img/image-20200603010530819.23aeea66.png" alt=""></p> <h2 id="_5-2-通过mycat访问数据库"><a href="#_5-2-通过mycat访问数据库" class="header-anchor">#</a> 5.2 通过Mycat访问数据库</h2> <h3 id="_5-2-1-server-xml配置"><a href="#_5-2-1-server-xml配置" class="header-anchor">#</a> 5.2.1 server.xml配置</h3> <p>应用连接mycat的话，也需要设置用户名、密码、被连接数据库信息，要配置这些信息的话，可以修改server.xml，在其内部添加内容如下：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--配置自定义用户信息--&gt;</span>
<span class="token comment">&lt;!--连接用户名--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mycat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--连接密码--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>mycat<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--创建虚拟数据库--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schemas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>userDB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--指定该库是否只读--&gt;</span>
    <span class="token comment">&lt;!--&lt;property name=&quot;readOnly&quot;&gt;true&lt;/property&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_5-2-2-schema-xml配置"><a href="#_5-2-2-schema-xml配置" class="header-anchor">#</a> 5.2.2 schema.xml配置</h3> <p>当配置了一个虚拟数据库后，还需要修改schema.xml，对虚拟库进行详细配置</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mycat:schema</span> <span class="token name">SYSTEM</span> <span class="token string">&quot;schema.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mycat:</span>schema</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>mycat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://io.mycat/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

	<span class="token comment">&lt;!--配置虚拟数据库--&gt;</span>
	<span class="token comment">&lt;!--name：虚拟逻辑数据库名称，对应server.xml中的schemas属性值--&gt;</span>
	<span class="token comment">&lt;!--dataNode：逻辑库中逻辑表的默认数据节点--&gt;</span>
	<span class="token comment">&lt;!--sqlMaxLimit：类似于SQL上添加limit，如schema为非分片库，则该属性无效--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localdn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>500<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--配置虚拟逻辑表--&gt;</span>
		<span class="token comment">&lt;!--name：逻辑表名称，必须唯一--&gt;</span>
		<span class="token comment">&lt;!--dataNode：逻辑表所处的数据节点，值必须与dataNode标签中的name属性对应。如果值过多可以用$连接，如：dn$1-99,dn$200-400--&gt;</span>
		<span class="token comment">&lt;!--primaryKey：逻辑表对应的真实表的主键id的字段名--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localdn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>

	<span class="token comment">&lt;!--配置dataNode信息--&gt;</span>
	<span class="token comment">&lt;!--name：当前datanode名称--&gt;</span>
	<span class="token comment">&lt;!--dataHost：分片节点所处的节点主机，该值必须与dataHost标签中的name属性对应--&gt;</span>
	<span class="token comment">&lt;!--database：当前数据节点所对应的实际物理数据库--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localdn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localdh<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

	<span class="token comment">&lt;!--配置节点主机--&gt;</span>
	<span class="token comment">&lt;!--balance：用于进行读操作指向，有三个值可选
		0：所有读操作都发送到当前可用的writeHost上
		1：所有读操作都随机的发送到readHost上
		2：所有读操作都随机发送在writeHost与readHost上
	--&gt;</span>
	<span class="token comment">&lt;!--maxCon：指定每个读写实例连接池的最大连接。也就是说，标签内嵌套的writeHost、readHost标签都会使用这个属性的值来实例化出连接池的最大连接数--&gt;</span>
	<span class="token comment">&lt;!--minCon：指定每个读写实例连接池的最小连接，初始化连接池的大小--&gt;</span>
	<span class="token comment">&lt;!--name：当前节点主机名称，不允许出现重复--&gt;</span>
	<span class="token comment">&lt;!--dbType：当时使用的数据库类型--&gt;</span>
	<span class="token comment">&lt;!--dbDriver：当前使用的数据库驱动--&gt;</span>
	<span class="token comment">&lt;!--writeType：用于写操作指向，有三个值可选
		0：所有写操作都发送到可用的writeHost上
		1：所有写操作都随机发送到readHost上
		2：所有写操作都随机发送在writeHost与readHost上
	--&gt;</span>
	<span class="token comment">&lt;!--readHost是从属于writeHost的，即意味着它从那个writeHost获取同步数据。
		因此，当它所属的writeHost宕机了，则它也不会再参与到读写分离中来，即“不工作了”。这是因为此时，它的数据已经“不可靠”了。
		基于这个考虑，目前mycat 1.3和1.4版本中，若想支持MySQL一主一从的标准配置，并且在主节点宕机的情况下，从节点还能读取数据。
		则需要在Mycat里配置为两个writeHost并设置banlance=1。”--&gt;</span>
	<span class="token comment">&lt;!--switchType：设置节点切换操作，有三个值可选
		-1：不自动切换
		1：自动切换，默认值
		2：基于mysql主从同步的状态决定是否切换
	--&gt;</span>
	<span class="token comment">&lt;!--slaveThreshold：主从同步状态决定是否切换，延迟超过该值就不切换--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localdh<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--查询心跳--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--配置写节点实际物理数据库信息--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://localhost:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mycat:</span>schema</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h3 id="_5-2-3-访问测试"><a href="#_5-2-3-访问测试" class="header-anchor">#</a> 5.2.3 访问测试</h3> <p>通过navicat创建本地数据库连接并创建对应数据库，同时创建mycat连接。 在mycat连接中操作表，添加数据，可以发现，本地数据库中同步的也新增了对应的数据。</p> <h2 id="_5-3-数据分片"><a href="#_5-3-数据分片" class="header-anchor">#</a> 5.3 数据分片</h2> <h3 id="_5-3-1-取模分片"><a href="#_5-3-1-取模分片" class="header-anchor">#</a> 5.3.1 取模分片</h3> <p>当一个数据表中的数据量非常大时，就需要考虑对表内数据进行分片，拆分的规则有很多种，比较简单的一种就是，通过对id进行取模，完成数据分片。</p> <ol><li><strong>修改schema.xml</strong></li></ol> <p>table标签新增属性：subTables、rule</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mycat:schema</span> <span class="token name">SYSTEM</span> <span class="token string">&quot;schema.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mycat:</span>schema</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>mycat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://io.mycat/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

	<span class="token comment">&lt;!--配置虚拟数据库--&gt;</span>
	<span class="token comment">&lt;!--name：虚拟逻辑数据库名称，对应server.xml中的schemas属性值--&gt;</span>
	<span class="token comment">&lt;!--dataNode：逻辑库中逻辑表的默认数据节点--&gt;</span>
	<span class="token comment">&lt;!--sqlMaxLimit：类似于SQL上添加limit，如schema为非分片库，则该属性无效--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localdn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>500<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--配置虚拟逻辑表--&gt;</span>
		<span class="token comment">&lt;!--name：逻辑表名称，必须唯一--&gt;</span>
		<span class="token comment">&lt;!--dataNode：逻辑表所处的数据节点，值必须与dataNode标签中的name属性对应。如果值过多可以用$连接，如：dn$1-99,dn$200-400--&gt;</span>
		<span class="token comment">&lt;!--primaryKey：逻辑表对应的真实表的主键id的字段名--&gt;</span>
		<span class="token comment">&lt;!--subTables：分表的名称。可以存在多个，tb_user1,tb_user2,tb_user3.如果分表较多，可以通过$连接：tb_user$1-3--&gt;</span>
		<span class="token comment">&lt;!--rule：分片规则，对应rule.xml中配置--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localdn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">subTables</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user$1-3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod-long<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>

	<span class="token comment">&lt;!--配置dataNode信息--&gt;</span>
	<span class="token comment">&lt;!--name：当前datanode名称--&gt;</span>
	<span class="token comment">&lt;!--dataHost：分片节点所处的节点主机，该值必须与dataHost标签中的name属性对应--&gt;</span>
	<span class="token comment">&lt;!--database：当前数据节点所对应的实际物理数据库--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localdn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localdh<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

	<span class="token comment">&lt;!--配置节点主机--&gt;</span>
	<span class="token comment">&lt;!--balance：用于进行读操作指向，有三个值可选
		0：所有读操作都发送到当前可用的writeHost上
		1：所有读操作都随机的发送到readHost上
		2：所有读操作都随机发送在writeHost与readHost上
	--&gt;</span>
	<span class="token comment">&lt;!--maxCon：指定每个读写实例连接池的最大连接。也就是说，标签内嵌套的writeHost、readHost标签都会使用这个属性的值来实例化出连接池的最大连接数--&gt;</span>
	<span class="token comment">&lt;!--minCon：指定每个读写实例连接池的最小连接，初始化连接池的大小--&gt;</span>
	<span class="token comment">&lt;!--name：当前节点主机名称，不允许出现重复--&gt;</span>
	<span class="token comment">&lt;!--dbType：当时使用的数据库类型--&gt;</span>
	<span class="token comment">&lt;!--dbDriver：当前使用的数据库驱动--&gt;</span>
	<span class="token comment">&lt;!--writeType：用于写操作指向，有三个值可选
		0：所有写操作都发送到可用的writeHost上
		1：所有写操作都随机发送到readHost上
		2：所有写操作都随机发送在writeHost与readHost上
	--&gt;</span>
	<span class="token comment">&lt;!--readHost是从属于writeHost的，即意味着它从那个writeHost获取同步数据。
		因此，当它所属的writeHost宕机了，则它也不会再参与到读写分离中来，即“不工作了”。这是因为此时，它的数据已经“不可靠”了。
		基于这个考虑，目前mycat 1.3和1.4版本中，若想支持MySQL一主一从的标准配置，并且在主节点宕机的情况下，从节点还能读取数据。
		则需要在Mycat里配置为两个writeHost并设置banlance=1。”--&gt;</span>
	<span class="token comment">&lt;!--switchType：设置节点切换操作，有三个值可选
		-1：不自动切换
		1：自动切换，默认值
		2：基于mysql主从同步的状态决定是否切换
	--&gt;</span>
	<span class="token comment">&lt;!--slaveThreshold：主从同步状态决定是否切换，延迟超过该值就不切换--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localdh<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--查询心跳--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--配置写节点实际物理数据库信息--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://localhost:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mycat:</span>schema</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><ol start="2"><li><strong>修改rule.xml</strong></li></ol> <p>​	在schema.xml中已经指定规则为mod-long。因此需要到该文件中修改对应信息。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod-long<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--当用用于id取模的字段--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>user_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>mod-long<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--修改当前的分片数量--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod-long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByMod<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- how many data nodes --&gt;</span>
		<span class="token comment">&lt;!-- 根据datanode数量进行取模分片，也就是要模几。 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="3"><li><strong>新增数据</strong></li></ol> <ul><li><p>向数据库中插入9条数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>通过id查询数据</p> <p><img src="/pro/assets/img/image-20210608092140619.c7a86bfb.png" alt="image-20210608092140619"></p></li> <li><p>查询所有数据</p></li></ul> <p><img src="/pro/assets/img/image-20210608092208288.77155e97.png" alt="image-20210608092208288"></p> <ol start="4"><li><strong>问题分析</strong></li></ol> <ul><li><p>散列不均匀，出现数据倾斜</p> <ul><li>每张表中的数据量差距较大</li></ul></li> <li><p>动态扩容时，存在rehash，出现数据丢失</p> <ul><li>动态扩容后新增表时，需要对模数修改时有可能就会造成当查询某个分片时，在该分片中找不到对应数据</li></ul></li></ul> <h3 id="_5-3-2-全局id分片"><a href="#_5-3-2-全局id分片" class="header-anchor">#</a> 5.3.2 全局id分片</h3> <p>当进行数据切分后，数据会存放在多张表中，如果仍然通过数据库自增id的方式，就会出现ID重复的问题，造成数据错乱。所以当拆分完数据后，需要让每一条数据都有自己的ID，并且在多表中不能出现重复。比较常见的会使用雪花算法来生成分布式id。</p> <p>在Mycat中也提供了四种方式来进行分布式id生成：基于文件、基于数据库、基于时间戳和基于ZooKeeper。</p> <p><strong>基于本地文件</strong></p> <p><strong>优点：</strong></p> <ul><li>本地加载，读取速度较快</li></ul> <p><strong>缺点：</strong></p> <ul><li><p>MyCAT重新发布后，配置文件中的sequence会初始化</p></li> <li><p>生成的id没有意义</p></li> <li><p>MyCat如果存在多个，会出现id重复冲突</p></li></ul> <p><strong>流程:</strong></p> <ol><li>修改<strong>sequence_conf.properties</strong></li></ol> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">USER.HISIDS</span><span class="token punctuation">=</span>  <span class="token attr-value">#使用过的历史分段，可不配置</span>
<span class="token attr-name">USER.MINID</span><span class="token punctuation">=</span><span class="token attr-value">1  #最小ID值</span>
<span class="token attr-name">USER.MAXID</span><span class="token punctuation">=</span><span class="token attr-value">200000  #最大ID值</span>
<span class="token attr-name">USER.CURID</span><span class="token punctuation">=</span><span class="token attr-value">1000  #当前ID值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>修改<strong>server.xml</strong></li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--设置全局序号生成方式
   0：文件
   1：数据库
   2：时间戳
   3：zookeeper
  --&gt;</span>
<span class="token comment">&lt;!--必须带有MYCATSEQ_或者 mycatseq_进入序列匹配流程 注意MYCATSEQ_有空格的情况--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sequenceHandlerType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sequnceHandlerPattern<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>(?:(\s*next\s+value\s+for\s*MYCATSEQ_(\w+))(,|\)|\s)*)+<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>subqueryRelationshipCheck<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 子查询中存在关联查询的情况下,检查关联字段中是否有分片字段 .默认 false --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sequenceHanlderClass<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>io.mycat.route.sequence.handler.HttpIncrSequenceHandler<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>测试:</strong></p> <p>插入数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t_user<span class="token punctuation">(</span>user_id<span class="token punctuation">,</span>user_name<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'next value for MYCATSEQ_USER'</span><span class="token punctuation">,</span><span class="token string">'wangwu'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>其他三种配置方式:</strong></p> <ol><li>==<strong>数据库:</strong>==</li></ol> <ul><li>执行dbseq.sql中的sql语句，执行完毕后，会创建一张表</li></ul> <p><img src="data:image/png;base64,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iIgUDE6IiIiIiMgSdKN13blzp6ydH3vssYpfEBEREdFq4mhdRKtHF5zwYSQiIiIiotXCZl1ERERERGQJDE6IiIiIiMgSGJwQEREREZElMDghIiIiIiJLYHBCRERERESWwOCEiIiIiIgsgcEJERERERFZAoMTIiIiIiKyBAYnRERERERkCQxOiIiIiIjIEhicEBERERGRJTA4ISIiIiIiS2BwQkRERERElsDghIiIiIiILIHBCRERERERWQKDEyIiIiIisgQGJ0REREREZAkMToiIiIiIyBIYnBARERERkSUwOCEiIiIiIktgcEJERERERJbA4ISIiIiIiCyBwQkREREREVkCgxMiIiIiIrIEBidERERERGQJDE6IiIiIiMgSGJwQEREREZElMDghIiIiIiJLYHBCRERERESWwOCEiIiIiIgsgcEJERERERFZAoMTIiIiIiKyBAYnRERERERkCQxOiIiIiIjIEhicEBERERGRJTA4ISIiIiIiS2BwQkRERERElsDghIiIiIiILIHBCRERERERWQKDEyIiIiIisgQGJ0REREREZAkMToiIiIiIyBIYnBARERERkSUwOCEiIiIiIktgcEJERERERJbA4ISIiIiIiCyBwQkREREREVkCgxMiIiIiIrIEBidERERERGQJDE6IiIiIiMgSGJwQEREREZElMDghIiIiIiJLYHBCRERERESWwOCEiIiIiIgsgcEJERERERFZAoMTIiIiIiKyBAYnRERERERkCQxOiIiIiIjIEhicEBERERGRJfx/AvZ3hwgPXmUAAAAASUVORK5CYII=" alt=""></p> <ul><li>修改sequence_db_conf.properties</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>TB_USER=localdn #dataNode的name属性的名字
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><strong>修改server.xml文件</strong>，修改全局序列号生成方式为数据库方式</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sequenceHandlerType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>修改schema.xml, 在table中添加自增属性</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>localdn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">subTables</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user$1-3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod-long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autoIncrement</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>执行语句</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> tb_user<span class="token punctuation">(</span>user_id<span class="token punctuation">,</span>user_name<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'next value for MYCATSEQ_TB_USER'</span><span class="token punctuation">,</span><span class="token string">'wangwu'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>特点</p> <ul><li><p>本地加载，读取速度较快</p></li> <li><p>当MyCAT重新发布后，配置文件中的sequence会恢复到初始值</p></li> <li><p>生成的id没有含义，如时间</p></li> <li><p>MyCat如果存在多个，会出现id重复问题</p></li></ul></li></ul> <ol start="2"><li>==<strong>zookeeper</strong>==</li></ol> <ul><li>修改<strong>server.xml</strong>，更改生成模式</li></ul> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sequenceHandlerType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>修改<strong>myid.properties</strong>，配置zk连接信息</li></ul> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token attr-name">loadZk</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
<span class="token attr-name">zkURL</span><span class="token punctuation">=</span><span class="token attr-value">192.168.200.131:2181</span>
<span class="token attr-name">clusterId</span><span class="token punctuation">=</span><span class="token attr-value">01</span>
<span class="token attr-name">myid</span><span class="token punctuation">=</span><span class="token attr-value">mycat_fz_01</span>
<span class="token attr-name">clusterNodes</span><span class="token punctuation">=</span><span class="token attr-value">mycat_fz_01</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>修改<strong>sequence_distributed_conf.properties</strong></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>INSTANCEID=ZK #声明使用zk生成
CLUSTERID=01
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>新增数据</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#MYCATSEQ_这个后缀可以随便写即可</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_user<span class="token punctuation">(</span>user_id<span class="token punctuation">,</span>user_name<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'next value for MYCATSEQ_TB_AAAA'</span><span class="token punctuation">,</span><span class="token string">'atguigu'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>特点
<ul><li>ID 结构：<strong>long 64 位</strong>，ID 最大可占 63 位</li> <li>可以承受单机房单机器单线程 1000*(2^6)=640000 的并发。</li> <li>无悲观锁，无强竞争，吞吐量更高</li></ul></li></ul> <ol start="3"><li><strong>==时间戳==</strong></li></ol> <ul><li><p>修改<strong>server.xml</strong>。更改生成方式</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sequenceHandlerType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>修改<strong>sequence_time_conf.properties</strong></p></li></ul> <div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#sequence depend on TIME</span>
<span class="token comment">#WORKID与DATAACENTERID: 0-31 任意整数。多mycat节点下，每个节点的WORKID、DATAACENTERID不能重复，组成唯一标识，总共支持32*32=1024 种组合</span>
<span class="token attr-name">WORKID</span><span class="token punctuation">=</span><span class="token attr-value">01</span>
<span class="token attr-name">DATAACENTERID</span><span class="token punctuation">=</span><span class="token attr-value">01</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>新增数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">#MYCATSEQ_这个后缀可以随便写即可</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_user<span class="token punctuation">(</span>user_id<span class="token punctuation">,</span>user_name<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'next value for MYCATSEQ_TB_BBBB'</span><span class="token punctuation">,</span><span class="token string">'atguigu'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>特点</p> <ul><li>不存在id重复的现象</li> <li>数据类型太长，建议字段类型采用bigint(最大取值18446744073709551615)</li></ul></li></ul> <h3 id="_5-3-3-枚举分片"><a href="#_5-3-3-枚举分片" class="header-anchor">#</a> 5.3.3 枚举分片</h3> <p>适用于在特定业务场景下，将不同的数据存放于不同的数据库中，如按省份存放订单、按存放人员信息等。</p> <ol><li>修改<strong>schema.xml</strong>，修改<strong>table</strong>标签中<strong>name</strong>属性为当前操作的表名，<strong>rule</strong>属性为<strong>sharding-by-intfile</strong></li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user_sharding_by_intfile<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn129,dn130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-intfile<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>修改<strong>rule.xml</strong>，配置<strong>tableRule</strong>为<strong>sharding-by-intfile</strong>中<strong>columns</strong>属性为当前指定分片字段</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-intfile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>sex<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>hash-int<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>修改<strong>rule.xml</strong>中<strong>hash-int</strong></li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hash-int<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByFileMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>partition-hash-int.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--type默认值为0，0表示Integer，非零表示String--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--defaultNode 当有一些特殊数据信息可以存放于默认节点中，如即不是male也不是female。默认节点：小于0表示不设置默认节点，大于等于0表示设置默认节点,不能解析的枚举就存到默认节点--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultNode<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="4"><li>修改<strong>partition-hash-int.txt</strong>。指定分片字段不同值存在于不同的数据库节点</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>male=0 #代表第一个datanode
female=1 #代表第二个datanode
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="5"><li><p>注意事项</p> <p>==<strong>该方案适用于特定业务场景进行数据分片，但该方式容易出现数据倾斜，如不同省份的订单量一定会不同。订单量大的省份还会进行数据分库，数据库架构就会继续发生对应改变。</strong>==</p></li></ol> <h3 id="_5-3-4-固定hash分片"><a href="#_5-3-4-固定hash分片" class="header-anchor">#</a> 5.3.4 固定hash分片</h3> <p>固定hash分片的工作原理类似与redis cluster槽的概念，在固定hash中会有一个范围是0-1024，内部会进行二进制运算操作，如取 id 的二进制低10 位 与 1111111111 进行&amp;运算。从而当出现连接数据插入，其有可能会进入到同一个分片中，减少了分布式事务操作，提升插入效率同时尽量减少了数据倾斜问题，但不能避免不出现数据倾斜。</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>按照上面这张图就存在两个分区，partition1和partition2。partition1的范围是0-255，partition2的范围是256-1024。</p> <p>当向分区中存数据时，先将id值转换为二进制，接着&amp;1111111111，再对结果值转换为十进制，从而确定当前数据应该存入哪个分区中。</p> <ul><li><p>1023的二进制&amp;1111111111运算后为1023，故落入第二个分区</p></li> <li><p>1024的二进制&amp;1111111111运算后为0，故落入第一个分区</p></li> <li><p>266 的二进制&amp;1111111111运算后为266，故落入第二个分区内</p></li></ul> <ol><li>修改<strong>schema.xml</strong>，配置自定义固定hash分配规则</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user_fixed_hash<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn129,dn130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>partition-by-fixed-hash<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>修改<strong>rule.xml</strong>，配置自定义固定hash分片规则</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>partition-by-fixed-hash<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>user_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>partition-by-fixed-hash<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--
  partitionCount: 存在多少个节点，如1,1    1,1,1
  partitionLength: 每个节点分配的范围大小
 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>partition-by-fixed-hash<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByLong<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>partitionCount<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1,1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>partitionLength<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>256,768<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="3"><li>测试，添加数据，可以发现数据会根据计算，落入相应的数据库节点。</li></ol> <h3 id="_5-3-5-固定范围分片"><a href="#_5-3-5-固定范围分片" class="header-anchor">#</a> 5.3.5 固定范围分片</h3> <p>该规则有点像枚举与固定hash的综合体，设置某一个字段，然后规定该字段值的不同范围值会进入到哪一个dataNode。适用于明确知道分片字段的某个范围属于某个分片</p> <p>优点：适用于想明确知道某个分片字段的某个范围具体在哪一个节点</p> <p>缺点：如果短时间内有大量的批量插入操作，那么某个分片节点可能一下子会承受比较大的数据库压力，而别的分片节点此时可能处于闲置状态，无法利用其它节点进行分担压力（热点数据问题)</p> <ol><li>修改<strong>schema.xml</strong>。</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user_range<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn129,dn130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>auto-sharding-long<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>修改<strong>rule.xml</strong></li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>auto-sharding-long<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>age<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>rang-long<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>修改<strong>autopartition-long.txt</strong>，定义自定义范围</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#用于定义dataNode对应的数据范围，如果配置多了会报错。
# range start-end ,data node index
# K=1000,M=10000.
#0-500M=0
#500M-1000M=1
#1000M-1500M=2

#所有的节点配置都是从0开始，0代表节点1
0-20=0
21-50=1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="4"><li>测试，添加用户信息，年龄分别为9和33</li></ol> <h3 id="_5-3-6-取模范围分片"><a href="#_5-3-6-取模范围分片" class="header-anchor">#</a> 5.3.6 取模范围分片</h3> <p>这种方式结合了范围分片和取模分片，主要是为后续的数据迁移做准备。</p> <p>优点：可以自主决定取模后数据的节点分布</p> <p>缺点：dataNode 划分节点是事先建好的，需要扩展时比较麻烦</p> <ol><li>修改schema.xml，配置分片规则</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user_mod_range<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn129,dn130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-partition<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>修改rule.xml，添加分片规则</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-partition<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>user_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>sharding-by-partition<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-partition<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByPattern<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--求模基数--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>patternValue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>256<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--默认节点--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultNode<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--指定规则配置文件--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>partition-pattern.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="3"><li>添加partition-pattern.txt，文件内部配置节点中数据范围</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>#0-128表示id%256后的数据范围。
0-128=0
129-256=1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="4"><li>测试</li></ol> <h3 id="_5-3-7-字符串hash分片"><a href="#_5-3-7-字符串hash分片" class="header-anchor">#</a> 5.3.7 字符串hash分片</h3> <p>在业务场景下，有时可能会根据某个分片字段的前几个值来进行取模。如地址信息只取省份、姓名只取前一个字的姓等。此时则可以使用该种方式。</p> <p>其工作方式与取模范围分片类型，该分片方式支持数值、符号、字母取模。</p> <ol><li>修改schema.xml。</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user_string_hash<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn129,dn130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-string-hash<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>修改rule.xml，定义拆分规则</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-string-hash<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>user_name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>sharding-by-string-hash-function<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-string-hash-function<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByPrefixPattern<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--求模基数 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>patternValue<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>256<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 截取的位数  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prefixLength<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>partition-pattern-string-hash.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="3"><li>新建partition-pattern-string-hash.txt。指定数据分片节点</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>0-128=0
129-256=1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>4）运行后可以发现 ，不同的姓名取模后，会进入不同的分片节点。</p> <h3 id="_5-3-8-一致性hash"><a href="#_5-3-8-一致性hash" class="header-anchor">#</a> 5.3.8 一致性hash</h3> <p>通过一致性hash分片可以最大限度的让数据均匀分布，但是均匀分布也会带来问题，就是分布式事务。</p> <p><strong>原理(重点)</strong></p> <p>一致性hash算法引入了hash环的概念。环的大小是0~2^32-1。首先通过crc16算法计算出数据节点在hash环中的位置。</p> <p><img src="/pro/assets/img/image-20200614115947722.1b7d752a.png" alt=""></p> <p>当存储数据时，也会采用同样的算法，计算出数据key的hash值，映射到hash环上。</p> <p><img src="/pro/assets/img/image-20200614120302675.b6bc87d8.png" alt=""></p> <p>然后从数据映射的位置开始，以顺时针的方式找出距离最近的数据节点，接着将数据存入到该节点中。</p> <p><img src="/pro/assets/img/image-20200614121047323.eefee5f7.png" alt=""></p> <p>此时可以发现，数据并没有达到预期的数据均匀，可以发现如果两个数据节点在环上的距离，决定有大量数据存入了dataNode2，而仅有少量数据存入dataNode1。</p> <p>为了解决数据不均匀的问题，在mycat中可以设置<strong>虚拟数据映射节点</strong>。同时这些虚拟节点会映射到实际数据节点。</p> <p><img src="/pro/assets/img/image-20200614121729209.c44657f9.png" alt=""></p> <p>数据仍然以顺时针方式寻找数据节点，当找到最近的数据节点无论是实际还是虚拟，都会进行存储，如果是虚拟数据节点的话，最终会将数据保存到实际数据节点中。 从而尽量的使数据均匀分布。</p> <p>实现流程如下:</p> <ol><li><p>修改schema.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user_murmur<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn129,dn130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-murmur<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>修改rule.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-murmur<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>user_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>murmur<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>murmur<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByMurmurHash<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>seed<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 默认是0即可 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 要分片的数据库节点数量，必须指定，否则没法分片 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>virtualBucketTimes<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>160<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 一个实际的数据库节点被映射为这么多虚拟节点，默认是160倍，也就是虚拟节点数是物理节点数的160倍 --&gt;</span>
    <span class="token comment">&lt;!-- &lt;property name=&quot;weightMapFile&quot;&gt;weightMapFile&lt;/property&gt; 节点的权重，没有指定权重的节点默认是1。以properties文件的格式填写，以从0开始到count-1的整数值也就是节点索引为key，以节点权重值为值。所有权重值必须是正整数，否则以1代替 --&gt;</span>
    <span class="token comment">&lt;!-- &lt;property name=&quot;bucketMapPath&quot;&gt;/etc/mycat/bucketMapPath&lt;/property&gt;
   用于测试时观察各物理节点与虚拟节点的分布情况，如果指定了这个属性，会把虚拟节点的murmur hash值与物理节点的映射按行输出到这个文件，没有默认值，如果不指定，就不会输出任何东西 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>测试: 循环插入一千条数据，数据会尽量均匀的分布在两个节点中。</p></li></ol> <h3 id="_5-3-9-时间分片"><a href="#_5-3-9-时间分片" class="header-anchor">#</a> 5.3.9 时间分片</h3> <p>当数据量非常大时，有时会考虑，按天去分库分表。这种场景是非常常见的。同时也有利于后期的数据查询。</p> <ol><li><p>修改schema.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user_day<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn129,dn130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-date<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>修改rule.xml，每十天一个分片，从起始时间开始计算，分片不够，则报错。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-date<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>create_time<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>partbyday<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>partbyday<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByDate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--日期格式--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dateFormat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>yyyy-MM-dd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sNaturalDay<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--从哪天开始,并且只能插入2020年的数据，2021的无法插入--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sBeginDate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2020-01-01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--每隔几天一个分片--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sPartionDay<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li> <li><p>测试: 当时间为1月1-10号之间，会进入129节点。当时间为11-20号之间，会进入130节点，当超出则报错。</p></li></ol> <h2 id="_5-4-跨库join"><a href="#_5-4-跨库join" class="header-anchor">#</a> 5.4 跨库join</h2> <h3 id="_5-4-1-全局表"><a href="#_5-4-1-全局表" class="header-anchor">#</a> 5.4.1 全局表</h3> <p>系统中基本都会存在数据字典信息，如数据分类信息、项目的配置信息等。这些字典数据最大的特点就是数据量不大并且很少会被改变。同时绝大多数的业务场景都会涉及到字典表的操作。 因此为了避免频繁的跨库join操作，结合冗余数据思想，可以考虑把这些字典信息在每一个分库中都存在一份。</p> <p>mycat在进行join操作时，当业务表与全局表进行聚合会优先选择相同分片的全局表，从而避免跨库join操作。在进行数据插入时，会把数据同时插入到所有分片的全局表中。</p> <p>1）修改<strong>schema.xml</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_global<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn142,dn145<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>global_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>global<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_5-4-2-er表"><a href="#_5-4-2-er表" class="header-anchor">#</a> 5.4.2 ER表</h3> <p>ER表也是一种为了避免跨库join的手段，在业务开发时，经常会使用到主从表关系的查询，如商品表与商品详情表。</p> <p>ER表的出现就是为了让有关系的表数据存储于同一个分片中，从而避免跨库join的出现。</p> <ol><li>修改schema.xml</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_goods<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn129,dn130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding-by-murmur-goods<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>childTable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_goods_detail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods_detail_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">joinKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parentKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goods_id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>childTable</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>再次添加goods数据的时候,有关系的表数据存储于同一个分片中</li></ol> <h1 id="_6-mycat进阶"><a href="#_6-mycat进阶" class="header-anchor">#</a> 6 Mycat进阶</h1> <h2 id="_6-1-读写分离"><a href="#_6-1-读写分离" class="header-anchor">#</a> 6.1 读写分离</h2> <p>一个数据库的容量毕竟是有限制的，如果数据量非常大，分表已经满足不了的话，就会进行分库操作。分库架构如下：</p> <p><img src="/pro/assets/img/image-20200612002109456.aa0a0ae4.png" alt=""></p> <p>现在存在两个主库，并且各自都有从节点。 当插入数据时，根据id取模放入不同的库中。同时主从间在进行写时复制的同时，还要完成主从读写分离的配置。</p> <ol><li>修改schema.xml。配置多datenode与datahost。同时配置主从读写分离。</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mycat:schema</span> <span class="token name">SYSTEM</span> <span class="token string">&quot;schema.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mycat:</span>schema</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>mycat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://io.mycat/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn129<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>500<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>t_user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn129,dn130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod-long<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>

    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn129<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dh129<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dh130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dh129<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--查询心跳--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--配置写节点实际物理数据库信息--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.129:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--配置读节点实际物理数据库信息--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.130:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>readHost</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dh130<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--查询心跳--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--配置写节点实际物理数据库信息--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.129:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--配置读节点实际物理数据库信息--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.130:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>readHost</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mycat:</span>schema</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ol start="2"><li>修改rule.xml。配置取模时的模数</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod-long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByMod<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- how many data nodes --&gt;</span>
    <span class="token comment">&lt;!-- 根据datanode数量进行取模分片，也就是要模几。 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>读写分离验证</li></ol> <p>​	设置log4j2.xml的日志级别为DEBUG</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Configuration</span> <span class="token attr-name">status</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		........
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>asyncRoot</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span> <span class="token attr-name">includeLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			........
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>asyncRoot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Loggers</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>基于mysql服务进行数据查看，观察控制台信息，可以看到对于read请求的数据源，分别使用的是配置文件的配置</p> <p><img src="/pro/assets/img/image-20200621213109545.e77a1d12.png" alt=""></p> <p><img src="/pro/assets/img/image-20200621213153827.c3b45fbc.png" alt=""></p> <h2 id="_6-2-主从切换"><a href="#_6-2-主从切换" class="header-anchor">#</a> 6.2 主从切换</h2> <p>基于Mycat主从复制方案，当前存在一个主节点和一个从节点，主节点负责写操作，从节点负责读操作。当在一个dataHost中配置了两个或多个writeHost，如果第一个writeHost宕机，则Mycat会在默认3次心跳检查失败后，自动切换到下一个可用的writeHost执行DML语句，并在<strong>conf/dnindex.properties</strong>文件里记录当前所用的writeHost的index。</p> <p>在Mycat主从切换中，可以将从节点也配置为是一个写节点（相当于从节点同时负责读写）。当原有的master写节点宕机后，从节点会被提升为主节点，同时负责读写操作。当写节点恢复后，会被作为从节点使用，保持现有状态不变，跟随新的主节点。</p> <p>==<strong>简单点说就是：原来的主变成从，原来的从一直为主。</strong>==</p> <p>schema.xml配置</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mycat:schema</span> <span class="token name">SYSTEM</span> <span class="token string">&quot;schema.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mycat:</span>schema</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>mycat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://io.mycat/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn142<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>500<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tb_user<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn142<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user_id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>


	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn142<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dh142<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

	<span class="token comment">&lt;!--
		writeType:0  所有的写操作都发送到writeHost上
		balance:1 所有读操作都发送到readHost上
		switchType:2 基于mysql主从同步的状态决定是否切换
	--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dh142<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--查询心跳--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>show slave status<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!--配置写节点实际物理数据库信息--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.142:3309<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!--配置读节点实际物理数据库信息--&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.145:3309<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>readHost</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>

		<span class="token comment">&lt;!--配置从节点也会作为写节点使用--&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://192.168.200.145:3309<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host2<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mycat:</span>schema</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>测试:</p> <ul><li><p>开启host1和host2</p> <p>结论: 新增数据,全部新增到了host1中</p></li> <li><p>关闭host1</p> <p>结论: 新增数据,全部新增到了host2中</p></li> <li><p>再次开启host1</p> <p>结论: 新增数据,依然新增到host2中</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/pro/assets/js/app.fc49af57.js" defer></script><script src="/pro/assets/js/6.72f294c0.js" defer></script><script src="/pro/assets/js/5.1036e105.js" defer></script>
  </body>
</html>
